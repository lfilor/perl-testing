<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.36
Devel::Cover is copyright 2001-2019, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: blib/lib/TAP/Parser/Grammar.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">blib/lib/TAP/Parser/Grammar.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c2">97.4%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package TAP::Parser::Grammar;</td></tr>
<tr><td class="h">2</td><td colspan="7"></td></tr><tr><td class="h">3</td><td><div class="c3">31</div><div class="c3">31</div><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L3">31</a></div></td><td></td><td><div>385</div><div>27</div><div>494</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">4</td><td><div class="c3">31</div><div class="c3">31</div><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L4">31</a></div></td><td></td><td><div>51</div><div>33</div><div>479</div></td><td class="s">use warnings;</td></tr>
<tr><td class="h">5</td><td colspan="7"></td></tr><tr><td class="h">6</td><td><div class="c3">31</div><div class="c3">31</div><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L6">31</a></div></td><td></td><td><div>5018</div><div>29</div><div>269</div></td><td class="s">use TAP::Parser::ResultFactory&nbsp;&nbsp;&nbsp;();</td></tr>
<tr><td class="h">7</td><td><div class="c3">31</div><div class="c3">31</div><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L7">31</a></div></td><td></td><td><div>5327</div><div>35</div><div>446</div></td><td class="s">use TAP::Parser::YAMLish::Reader ();</td></tr>
<tr><td class="h">8</td><td colspan="7"></td></tr><tr><td class="h">9</td><td><div class="c3">31</div><div class="c3">31</div><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L9">31</a></div></td><td></td><td><div>108</div><div>23</div><div>31014</div></td><td class="s">use base &#39;TAP::Object&#39;;</td></tr>
<tr><td class="h">10</td><td colspan="7"></td></tr><tr><td class="h">11 - 19</td><td colspan="6"></td><td class="s"><pre>=head1 NAME

TAP::Parser::Grammar - A grammar for the Test Anything Protocol.

=head1 VERSION

Version 3.42

=cut</pre></td></tr>
<tr><td class="h">20</td><td colspan="7"></td></tr><tr><td class="h">21</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &#39;3.42&#39;;</td></tr>
<tr><td class="h">22</td><td colspan="7"></td></tr><tr><td class="h">23 - 61</td><td colspan="6"></td><td class="s"><pre>=head1 SYNOPSIS

&nbsp;&nbsp;use TAP::Parser::Grammar;
&nbsp;&nbsp;my $grammar = $self-&gt;make_grammar({
&nbsp;&nbsp;&nbsp;&nbsp;iterator =&gt; $tap_parser_iterator,
&nbsp;&nbsp;&nbsp;&nbsp;parser&nbsp;&nbsp;&nbsp;=&gt; $tap_parser,
&nbsp;&nbsp;&nbsp;&nbsp;version&nbsp;&nbsp;=&gt; 12,
&nbsp;&nbsp;});

&nbsp;&nbsp;my $result = $grammar-&gt;tokenize;

=head1 DESCRIPTION

C&lt;TAP::Parser::Grammar&gt; tokenizes lines from a L&lt;TAP::Parser::Iterator&gt; and
constructs L&lt;TAP::Parser::Result&gt; subclasses to represent the tokens.

Do not attempt to use this class directly.&nbsp;&nbsp;It won&#39;t make sense.&nbsp;&nbsp;It&#39;s mainly
here to ensure that we will be able to have pluggable grammars when TAP is
expanded at some future date (plus, this stuff was really cluttering the
parser).

=head1 METHODS

=head2 Class Methods

=head3 C&lt;new&gt;

&nbsp;&nbsp;my $grammar = TAP::Parser::Grammar-&gt;new({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iterator =&gt; $iterator,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser&nbsp;&nbsp;&nbsp;=&gt; $parser,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version&nbsp;&nbsp;=&gt; $version,
&nbsp;&nbsp;});

Returns L&lt;TAP::Parser&gt; grammar object that will parse the TAP stream from the
specified iterator.&nbsp;&nbsp;Both C&lt;iterator&gt; and C&lt;parser&gt; are required arguments.
If C&lt;version&gt; is not set it defaults to C&lt;12&gt; (see L&lt;/set_version&gt; for more
details).

=cut</pre></td></tr>
<tr><td class="h">62</td><td colspan="7"></td></tr><tr><td class="h">63</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># new() implementation supplied by TAP::Object</td></tr>
<tr><td class="h">64</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _initialize {</td></tr>
<tr><td class="h">65</td><td><div class="c3">285</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L65">285</a></div></td><td></td><td><div>523</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $args ) = @_;</td></tr>
<tr><td class="h">66</td><td><div class="c3">285</div></td><td></td><td></td><td></td><td></td><td><div>461</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{iterator} = $args-&gt;{iterator};&nbsp;&nbsp;&nbsp;&nbsp;# TODO: accessor</td></tr>
<tr><td class="h">67</td><td><div class="c3">285</div></td><td></td><td><div class="c0"><a href="blib-lib-TAP-Parser-Grammar-pm--condition.html#L67">67</a></div></td><td></td><td></td><td><div>415</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{iterator} ||= $args-&gt;{stream};&nbsp;&nbsp;&nbsp;&nbsp;# deprecated</td></tr>
<tr><td class="h">68</td><td><div class="c3">285</div></td><td></td><td></td><td></td><td></td><td><div>6608</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{parser} = $args-&gt;{parser};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# TODO: accessor</td></tr>
<tr><td class="h">69</td><td><div class="c3">285</div></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--condition.html#L69">100</a></div></td><td></td><td></td><td><div>1570</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;set_version( $args-&gt;{version} || 12 );</td></tr>
<tr><td class="h">70</td><td><div class="c3">285</div></td><td></td><td></td><td></td><td></td><td><div>722</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self;</td></tr>
<tr><td class="h">71</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">72</td><td colspan="7"></td></tr><tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">my %language_for;</td></tr>
<tr><td class="h">74</td><td colspan="7"></td></tr><tr><td class="h">75</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">76</td><td colspan="7"></td></tr><tr><td class="h">77</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# XXX the &#39;not&#39; and &#39;ok&#39; might be on separate lines in VMS ...</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ok&nbsp;&nbsp;= qr/(?:not )?ok\b/;</td></tr>
<tr><td class="h">79</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $num = qr/\d+/;</td></tr>
<tr><td class="h">80</td><td colspan="7"></td></tr><tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %v12 = (</td></tr>
<tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version =&gt; {</td></tr>
<tr><td class="h">83</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;&nbsp;=&gt; qr/^TAP\s+version\s+(\d+)\s*\z/i,</td></tr>
<tr><td class="h">84</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">86</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $version = $1;</td></tr>
<tr><td class="h">87</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_version_token( $line, $version, );</td></tr>
<tr><td class="h">88</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">89</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">90</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plan =&gt; {</td></tr>
<tr><td class="h">91</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;&nbsp;=&gt; qr/^1\.\.(\d+)\s*(.*)\z/,</td></tr>
<tr><td class="h">92</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">93</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">94</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $tests_planned, $tail ) = ( $1, $2 );</td></tr>
<tr><td class="h">95</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $explanation = undef;</td></tr>
<tr><td class="h">96</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $skip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &#39;&#39;;</td></tr>
<tr><td class="h">97</td><td colspan="7"></td></tr><tr><td class="h">98</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $tail =~ /^todo((?:\s+\d+)+)/ ) {</td></tr>
<tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @todo = split /\s+/, _trim($1);</td></tr>
<tr><td class="h">100</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_plan_token(</td></tr>
<tr><td class="h">101</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line, $tests_planned, &#39;TODO&#39;,</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&#39;,&nbsp;&nbsp;&nbsp;&nbsp;\@todo</td></tr>
<tr><td class="h">103</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">104</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ( 0 == $tests_planned ) {</td></tr>
<tr><td class="h">106</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$skip = &#39;SKIP&#39;;</td></tr>
<tr><td class="h">107</td><td colspan="7"></td></tr><tr><td class="h">108</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If we can&#39;t match # SKIP the directive should be undef.</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($explanation) = $tail =~ /^#\s*SKIP\S*\s+(.*)/i;</td></tr>
<tr><td class="h">110</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">111</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $tail !~ /^\s*$/ ) {</td></tr>
<tr><td class="h">112</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_unknown_token($line);</td></tr>
<tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">114</td><td colspan="7"></td></tr><tr><td class="h">115</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$explanation = &#39;&#39; unless defined $explanation;</td></tr>
<tr><td class="h">116</td><td colspan="7"></td></tr><tr><td class="h">117</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_plan_token(</td></tr>
<tr><td class="h">118</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line, $tests_planned, $skip,</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$explanation, []</td></tr>
<tr><td class="h">120</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">121</td><td colspan="7"></td></tr><tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">124</td><td colspan="7"></td></tr><tr><td class="h">125</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# An optimization to handle the most common test lines without</td></tr>
<tr><td class="h">126</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# directives.</td></tr>
<tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simple_test =&gt; {</td></tr>
<tr><td class="h">128</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;&nbsp;=&gt; qr/^($ok) \ ($num) (?:\ ([^#]+))? \z/x,</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">131</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $ok, $num, $desc ) = ( $1, $2, $3 );</td></tr>
<tr><td class="h">132</td><td colspan="7"></td></tr><tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_test_token(</td></tr>
<tr><td class="h">134</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line, $ok, $num,</td></tr>
<tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$desc</td></tr>
<tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">137</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">138</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">139</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test =&gt; {</td></tr>
<tr><td class="h">140</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;&nbsp;=&gt; qr/^($ok) \s* ($num)? \s* (.*) \z/x,</td></tr>
<tr><td class="h">141</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">142</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">143</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $ok, $num, $desc ) = ( $1, $2, $3 );</td></tr>
<tr><td class="h">144</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $dir, $explanation ) = ( &#39;&#39;, &#39;&#39; );</td></tr>
<tr><td class="h">145</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($desc =~ m/^ ( [^\\\#]* (?: \\. [^\\\#]* )* )</td></tr>
<tr><td class="h">146</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\# \s* (SKIP|TODO) \b \s* (.*) $/ix</td></tr>
<tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
<tr><td class="h">148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">149</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $desc, $dir, $explanation ) = ( $1, $2, $3 );</td></tr>
<tr><td class="h">150</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">151</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_test_token(</td></tr>
<tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line, $ok, $num, $desc,</td></tr>
<tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dir,&nbsp;&nbsp;$explanation</td></tr>
<tr><td class="h">154</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">156</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">157</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment =&gt; {</td></tr>
<tr><td class="h">158</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;&nbsp;=&gt; qr/^#(.*)/,</td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">161</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $comment = $1;</td></tr>
<tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_comment_token( $line, $comment );</td></tr>
<tr><td class="h">163</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bailout =&gt; {</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;&nbsp;=&gt; qr/^\s*Bail out!\s*(.*)/,</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $explanation = $1;</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_bailout_token(</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line,</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$explanation</td></tr>
<tr><td class="h">173</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">176</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">177</td><td colspan="7"></td></tr><tr><td class="h">178</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %v13 = (</td></tr>
<tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%v12,</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plan =&gt; {</td></tr>
<tr><td class="h">181</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;&nbsp;=&gt; qr/^1\.\.(\d+)\s*(?:\s*#\s*SKIP\b(.*))?\z/i,</td></tr>
<tr><td class="h">182</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $tests_planned, $explanation ) = ( $1, $2 );</td></tr>
<tr><td class="h">185</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $skip</td></tr>
<tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= ( 0 == $tests_planned || defined $explanation )</td></tr>
<tr><td class="h">187</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;? &#39;SKIP&#39;</td></tr>
<tr><td class="h">188</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: &#39;&#39;;</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$explanation = &#39;&#39; unless defined $explanation;</td></tr>
<tr><td class="h">190</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_plan_token(</td></tr>
<tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line, $tests_planned, $skip,</td></tr>
<tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$explanation, []</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">194</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yaml =&gt; {</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;&nbsp;=&gt; qr/^ (\s+) (---.*) $/x,</td></tr>
<tr><td class="h">198</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $pad, $marker ) = ( $1, $2 );</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_yaml_token( $pad, $marker );</td></tr>
<tr><td class="h">202</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pragma =&gt; {</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax =&gt;</td></tr>
<tr><td class="h">206</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qr/^ pragma \s+ ( [-+] \w+ \s* (?: , \s* [-+] \w+ \s* )* ) $/x,</td></tr>
<tr><td class="h">207</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler =&gt; sub {</td></tr>
<tr><td class="h">208</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">209</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pragmas = $1;</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_make_pragma_token( $line, $pragmas );</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">214</td><td colspan="7"></td></tr><tr><td class="h">215</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;%language_for = (</td></tr>
<tr><td class="h">216</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;12&#39; =&gt; {</td></tr>
<tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tokens =&gt; \%v12,</td></tr>
<tr><td class="h">218</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">219</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;13&#39; =&gt; {</td></tr>
<tr><td class="h">220</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tokens =&gt; \%v13,</td></tr>
<tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setup&nbsp;&nbsp;=&gt; sub {</td></tr>
<tr><td class="h">222</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shift-&gt;{iterator}-&gt;handle_unicode;</td></tr>
<tr><td class="h">223</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">224</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">226</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">227</td><td colspan="7"></td></tr><tr><td class="h">228</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">##############################################################################</td></tr>
<tr><td class="h">229</td><td colspan="7"></td></tr><tr><td class="h">230 - 240</td><td colspan="6"></td><td class="s"><pre>=head2 Instance Methods

=head3 C&lt;set_version&gt;

&nbsp;&nbsp;$grammar-&gt;set_version(13);

Tell the grammar which TAP syntax version to support. The lowest
supported version is 12. Although &#39;TAP version&#39; isn&#39;t valid version 12
syntax it is accepted so that higher version numbers may be parsed.

=cut</pre></td></tr>
<tr><td class="h">241</td><td colspan="7"></td></tr><tr><td class="h">242</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub set_version {</td></tr>
<tr><td class="h">243</td><td><div class="c3">314</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L243">314</a></div></td><td><div class="c3">1</div></td><td><div>264</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self&nbsp;&nbsp;&nbsp;&nbsp;= shift;</td></tr>
<tr><td class="h">244</td><td><div class="c3">314</div></td><td></td><td></td><td></td><td></td><td><div>430</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $version = shift;</td></tr>
<tr><td class="h">245</td><td colspan="7"></td></tr><tr><td class="h">246</td><td><div class="c3">314</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L246">100</a></div></td><td></td><td></td><td></td><td><div>679</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( my $language = $language_for{$version} ) {</td></tr>
<tr><td class="h">247</td><td><div class="c3">313</div></td><td></td><td></td><td></td><td></td><td><div>359</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{version} = $version;</td></tr>
<tr><td class="h">248</td><td><div class="c3">313</div></td><td></td><td></td><td></td><td></td><td><div>415</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{tokens}&nbsp;&nbsp;= $language-&gt;{tokens};</td></tr>
<tr><td class="h">249</td><td colspan="7"></td></tr><tr><td class="h">250</td><td><div class="c3">313</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L250">100</a></div></td><td></td><td></td><td></td><td><div>331</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( my $setup = $language-&gt;{setup} ) {</td></tr>
<tr><td class="h">251</td><td><div class="c3">25</div></td><td></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;$setup();</td></tr>
<tr><td class="h">252</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">253</td><td colspan="7"></td></tr><tr><td class="h">254</td><td><div class="c3">313</div></td><td></td><td></td><td></td><td></td><td><div>575</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;_order_tokens;</td></tr>
<tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">256</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">257</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require Carp;</td></tr>
<tr><td class="h">258</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Carp::croak(&quot;Unsupported syntax version: $version&quot;);</td></tr>
<tr><td class="h">259</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">261</td><td colspan="7"></td></tr><tr><td class="h">262</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Optimization to put the most frequent tokens first.</td></tr>
<tr><td class="h">263</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _order_tokens {</td></tr>
<tr><td class="h">264</td><td><div class="c3">313</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L264">313</a></div></td><td></td><td><div>219</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">265</td><td colspan="7"></td></tr><tr><td class="h">266</td><td><div class="c3">313</div><div class="c3">313</div></td><td></td><td></td><td></td><td></td><td><div>254</div><div>1412</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %copy = %{ $self-&gt;{tokens} };</td></tr>
<tr><td class="h">267</td><td><div class="c3">1252</div></td><td></td><td></td><td></td><td></td><td><div>1069</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @ordered_tokens = grep {defined}</td></tr>
<tr><td class="h">268</td><td><div class="c3">313</div><div class="c3">1252</div></td><td></td><td></td><td></td><td></td><td><div>508</div><div>1150</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { delete $copy{$_} } qw( simple_test test comment plan );</td></tr>
<tr><td class="h">269</td><td><div class="c3">313</div></td><td></td><td></td><td></td><td></td><td><div>529</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @ordered_tokens, values %copy;</td></tr>
<tr><td class="h">270</td><td colspan="7"></td></tr><tr><td class="h">271</td><td><div class="c3">313</div></td><td></td><td></td><td></td><td></td><td><div>668</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{ordered_tokens} = \@ordered_tokens;</td></tr>
<tr><td class="h">272</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">273</td><td colspan="7"></td></tr><tr><td class="h">274</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">##############################################################################</td></tr>
<tr><td class="h">275</td><td colspan="7"></td></tr><tr><td class="h">276 - 283</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;tokenize&gt;

&nbsp;&nbsp;my $token = $grammar-&gt;tokenize;

This method will return a L&lt;TAP::Parser::Result&gt; object representing the
current line of TAP.

=cut</pre></td></tr>
<tr><td class="h">284</td><td colspan="7"></td></tr><tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tokenize {</td></tr>
<tr><td class="h">286</td><td><div class="c3">1609</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L286">1609</a></div></td><td><div class="c3">1</div></td><td><div>1194</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">287</td><td colspan="7"></td></tr><tr><td class="h">288</td><td><div class="c3">1609</div></td><td></td><td></td><td></td><td></td><td><div>2563</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $line = $self-&gt;{iterator}-&gt;next;</td></tr>
<tr><td class="h">289</td><td><div class="c3">1607</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L289">100</a></div></td><td></td><td></td><td></td><td><div>1689</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ( defined $line ) {</td></tr>
<tr><td class="h">290</td><td><div class="c3">269</div></td><td></td><td></td><td></td><td></td><td><div>438</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $self-&gt;{parser};&nbsp;&nbsp;&nbsp;&nbsp;# break circular ref</td></tr>
<tr><td class="h">291</td><td><div class="c3">269</div></td><td></td><td></td><td></td><td></td><td><div>344</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">292</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">293</td><td colspan="7"></td></tr><tr><td class="h">294</td><td><div class="c3">1338</div></td><td></td><td></td><td></td><td></td><td><div>1053</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $token;</td></tr>
<tr><td class="h">295</td><td colspan="7"></td></tr><tr><td class="h">296</td><td><div class="c3">1338</div><div class="c3">1338</div></td><td></td><td></td><td></td><td></td><td><div>955</div><div>1503</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $token_data ( @{ $self-&gt;{ordered_tokens} } ) {</td></tr>
<tr><td class="h">297</td><td><div class="c3">2951</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L297">100</a></div></td><td></td><td></td><td></td><td><div>8465</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $line =~ $token_data-&gt;{syntax} ) {</td></tr>
<tr><td class="h">298</td><td><div class="c3">1306</div></td><td></td><td></td><td></td><td></td><td><div>1168</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $handler = $token_data-&gt;{handler};</td></tr>
<tr><td class="h">299</td><td><div class="c3">1306</div></td><td></td><td></td><td></td><td></td><td><div>1772</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token = $self-&gt;$handler($line);</td></tr>
<tr><td class="h">300</td><td><div class="c3">1306</div></td><td></td><td></td><td></td><td></td><td><div>1243</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last;</td></tr>
<tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">303</td><td colspan="7"></td></tr><tr><td class="h">304</td><td><div class="c3">1338</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L304">100</a></div></td><td></td><td></td><td></td><td><div>1220</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$token = $self-&gt;_make_unknown_token($line) unless $token;</td></tr>
<tr><td class="h">305</td><td colspan="7"></td></tr><tr><td class="h">306</td><td><div class="c3">1338</div></td><td></td><td></td><td></td><td></td><td><div>1981</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{parser}-&gt;make_result($token);</td></tr>
<tr><td class="h">307</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">308</td><td colspan="7"></td></tr><tr><td class="h">309</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">##############################################################################</td></tr>
<tr><td class="h">310</td><td colspan="7"></td></tr><tr><td class="h">311 - 317</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;token_types&gt;

&nbsp;&nbsp;my @types = $grammar-&gt;token_types;

Returns the different types of tokens which this grammar can parse.

=cut</pre></td></tr>
<tr><td class="h">318</td><td colspan="7"></td></tr><tr><td class="h">319</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub token_types {</td></tr>
<tr><td class="h">320</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L320">2</a></div></td><td><div class="c3">1</div></td><td><div>384</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">321</td><td><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>1</div><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return keys %{ $self-&gt;{tokens} };</td></tr>
<tr><td class="h">322</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">323</td><td colspan="7"></td></tr><tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">##############################################################################</td></tr>
<tr><td class="h">325</td><td colspan="7"></td></tr><tr><td class="h">326 - 335</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;syntax_for&gt;

&nbsp;&nbsp;my $syntax = $grammar-&gt;syntax_for($token_type);

Returns a pre-compiled regular expression which will match a chunk of TAP
corresponding to the token type.&nbsp;&nbsp;For example (not that you should really pay
attention to this, C&lt;&lt; $grammar-&gt;syntax_for(&#39;comment&#39;) &gt;&gt; will return
C&lt;&lt; qr/^#(.*)/ &gt;&gt;.

=cut</pre></td></tr>
<tr><td class="h">336</td><td colspan="7"></td></tr><tr><td class="h">337</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub syntax_for {</td></tr>
<tr><td class="h">338</td><td><div class="c3">8</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L338">8</a></div></td><td><div class="c3">1</div></td><td><div>1527</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $type ) = @_;</td></tr>
<tr><td class="h">339</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{tokens}-&gt;{$type}-&gt;{syntax};</td></tr>
<tr><td class="h">340</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">341</td><td colspan="7"></td></tr><tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">##############################################################################</td></tr>
<tr><td class="h">343</td><td colspan="7"></td></tr><tr><td class="h">344 - 366</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;handler_for&gt;

&nbsp;&nbsp;my $handler = $grammar-&gt;handler_for($token_type);

Returns a code reference which, when passed an appropriate line of TAP,
returns the lexed token corresponding to that line.&nbsp;&nbsp;As a result, the basic
TAP parsing loop looks similar to the following:

 my @tokens;
 my $grammar = TAP::Grammar-&gt;new;
 LINE: while ( defined( my $line = $parser-&gt;_next_chunk_of_tap ) ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $type ( $grammar-&gt;token_types ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $syntax&nbsp;&nbsp;= $grammar-&gt;syntax_for($type);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $line =~ $syntax ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $handler = $grammar-&gt;handler_for($type);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @tokens =&gt; $grammar-&gt;$handler($line);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next LINE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @tokens =&gt; $grammar-&gt;_make_unknown_token($line);
 }

=cut</pre></td></tr>
<tr><td class="h">367</td><td colspan="7"></td></tr><tr><td class="h">368</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub handler_for {</td></tr>
<tr><td class="h">369</td><td><div class="c3">8</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L369">8</a></div></td><td><div class="c3">1</div></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $type ) = @_;</td></tr>
<tr><td class="h">370</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{tokens}-&gt;{$type}-&gt;{handler};</td></tr>
<tr><td class="h">371</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">372</td><td colspan="7"></td></tr><tr><td class="h">373</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_version_token {</td></tr>
<tr><td class="h">374</td><td><div class="c3">30</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L374">30</a></div></td><td></td><td><div>72</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line, $version ) = @_;</td></tr>
<tr><td class="h">375</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return {</td></tr>
<tr><td class="h">376</td><td><div class="c3">30</div></td><td></td><td></td><td></td><td></td><td><div>111</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;version&#39;,</td></tr>
<tr><td class="h">377</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $line,</td></tr>
<tr><td class="h">378</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version =&gt; $version,</td></tr>
<tr><td class="h">379</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">380</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">381</td><td colspan="7"></td></tr><tr><td class="h">382</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_plan_token {</td></tr>
<tr><td class="h">383</td><td><div class="c3">268</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L383">268</a></div></td><td></td><td><div>479</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line, $tests_planned, $directive, $explanation, $todo ) = @_;</td></tr>
<tr><td class="h">384</td><td colspan="7"></td></tr><tr><td class="h">385</td><td><div class="c3">268</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L385">100</a></div></td><td><div class="c1"><a href="blib-lib-TAP-Parser-Grammar-pm--condition.html#L385">75</a></div></td><td></td><td></td><td><div>542</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (&nbsp;&nbsp;&nbsp;$directive eq &#39;SKIP&#39;</td></tr>
<tr><td class="h">386</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; 0 != $tests_planned</td></tr>
<tr><td class="h">387</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; $self-&gt;{version} &lt; 13 )</td></tr>
<tr><td class="h">388</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">389</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn</td></tr>
<tr><td class="h">390</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Specified SKIP directive in plan but more than 0 tests ($line)\n&quot;;</td></tr>
<tr><td class="h">391</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">392</td><td colspan="7"></td></tr><tr><td class="h">393</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return {</td></tr>
<tr><td class="h">394</td><td><div class="c3">268</div></td><td></td><td></td><td></td><td></td><td><div>505</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;plan&#39;,</td></tr>
<tr><td class="h">395</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $line,</td></tr>
<tr><td class="h">396</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tests_planned =&gt; $tests_planned,</td></tr>
<tr><td class="h">397</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $directive,</td></tr>
<tr><td class="h">398</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;explanation&nbsp;&nbsp;&nbsp;=&gt; _trim($explanation),</td></tr>
<tr><td class="h">399</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;todo_list&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $todo,</td></tr>
<tr><td class="h">400</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">401</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">402</td><td colspan="7"></td></tr><tr><td class="h">403</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_test_token {</td></tr>
<tr><td class="h">404</td><td><div class="c3">875</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L404">875</a></div></td><td></td><td><div>1247</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line, $ok, $num, $desc, $dir, $explanation ) = @_;</td></tr>
<tr><td class="h">405</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return {</td></tr>
<tr><td class="h">406</td><td><div class="c3">875</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L406">100</a></div><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L406">100</a></div></td><td></td><td></td><td></td><td><div>1453</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $ok,</td></tr>
<tr><td class="h">407</td><td colspan="7"></td></tr><tr><td class="h">408</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# forcing this to be an integer (and not a string) reduces memory</td></tr>
<tr><td class="h">409</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# consumption. RT #84939</td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_num&nbsp;&nbsp;&nbsp;&nbsp;=&gt; ( defined $num ? 0 + $num : undef ),</td></tr>
<tr><td class="h">411</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description =&gt; _trim($desc),</td></tr>
<tr><td class="h">412</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directive&nbsp;&nbsp;&nbsp;=&gt; ( defined $dir ? uc $dir : &#39;&#39; ),</td></tr>
<tr><td class="h">413</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;explanation =&gt; _trim($explanation),</td></tr>
<tr><td class="h">414</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $line,</td></tr>
<tr><td class="h">415</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;test&#39;,</td></tr>
<tr><td class="h">416</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">417</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">418</td><td colspan="7"></td></tr><tr><td class="h">419</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_unknown_token {</td></tr>
<tr><td class="h">420</td><td><div class="c3">32</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L420">32</a></div></td><td></td><td><div>52</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line ) = @_;</td></tr>
<tr><td class="h">421</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return {</td></tr>
<tr><td class="h">422</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>55</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;&nbsp;=&gt; $line,</td></tr>
<tr><td class="h">423</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type =&gt; &#39;unknown&#39;,</td></tr>
<tr><td class="h">424</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">425</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">426</td><td colspan="7"></td></tr><tr><td class="h">427</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_comment_token {</td></tr>
<tr><td class="h">428</td><td><div class="c3">111</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L428">111</a></div></td><td></td><td><div>172</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line, $comment ) = @_;</td></tr>
<tr><td class="h">429</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return {</td></tr>
<tr><td class="h">430</td><td><div class="c3">111</div></td><td></td><td></td><td></td><td></td><td><div>114</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;comment&#39;,</td></tr>
<tr><td class="h">431</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $line,</td></tr>
<tr><td class="h">432</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment =&gt; _trim($comment)</td></tr>
<tr><td class="h">433</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">434</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">435</td><td colspan="7"></td></tr><tr><td class="h">436</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_bailout_token {</td></tr>
<tr><td class="h">437</td><td><div class="c3">9</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L437">9</a></div></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line, $explanation ) = @_;</td></tr>
<tr><td class="h">438</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return {</td></tr>
<tr><td class="h">439</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;bailout&#39;,</td></tr>
<tr><td class="h">440</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $line,</td></tr>
<tr><td class="h">441</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bailout =&gt; _trim($explanation)</td></tr>
<tr><td class="h">442</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">443</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">444</td><td colspan="7"></td></tr><tr><td class="h">445</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_yaml_token {</td></tr>
<tr><td class="h">446</td><td><div class="c3">10</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L446">10</a></div></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $pad, $marker ) = @_;</td></tr>
<tr><td class="h">447</td><td colspan="7"></td></tr><tr><td class="h">448</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $yaml = TAP::Parser::YAMLish::Reader-&gt;new;</td></tr>
<tr><td class="h">449</td><td colspan="7"></td></tr><tr><td class="h">450</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $iterator = $self-&gt;{iterator};</td></tr>
<tr><td class="h">451</td><td colspan="7"></td></tr><tr><td class="h">452</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Construct a reader that reads from our input stripping leading</td></tr>
<tr><td class="h">453</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# spaces from each line.</td></tr>
<tr><td class="h">454</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $leader = length($pad);</td></tr>
<tr><td class="h">455</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>74</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $strip&nbsp;&nbsp;= qr{ ^ (\s{$leader}) (.*) $ }x;</td></tr>
<tr><td class="h">456</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @extra&nbsp;&nbsp;= ($marker);</td></tr>
<tr><td class="h">457</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $reader = sub {</td></tr>
<tr><td class="h">458</td><td><div class="c3">50</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L458">100</a></div></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L458">50</a></div></td><td></td><td><div>45</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return shift @extra if @extra;</td></tr>
<tr><td class="h">459</td><td><div class="c3">40</div></td><td></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $line = $iterator-&gt;next;</td></tr>
<tr><td class="h">460</td><td><div class="c3">40</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L460">50</a></div></td><td></td><td></td><td></td><td><div>101</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $2 if $line =~ $strip;</td></tr>
<tr><td class="h">461</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">462</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">463</td><td colspan="7"></td></tr><tr><td class="h">464</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $data = $yaml-&gt;read($reader);</td></tr>
<tr><td class="h">465</td><td colspan="7"></td></tr><tr><td class="h">466</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Reconstitute input. This is convoluted. Maybe we should just</td></tr>
<tr><td class="h">467</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# record it on the way in...</td></tr>
<tr><td class="h">468</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;chomp( my $raw = $yaml-&gt;get_raw );</td></tr>
<tr><td class="h">469</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$raw =~ s/^/$pad/mg;</td></tr>
<tr><td class="h">470</td><td colspan="7"></td></tr><tr><td class="h">471</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return {</td></tr>
<tr><td class="h">472</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>72</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type =&gt; &#39;yaml&#39;,</td></tr>
<tr><td class="h">473</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;&nbsp;=&gt; $raw,</td></tr>
<tr><td class="h">474</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data =&gt; $data</td></tr>
<tr><td class="h">475</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">476</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">477</td><td colspan="7"></td></tr><tr><td class="h">478</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_pragma_token {</td></tr>
<tr><td class="h">479</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L479">7</a></div></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $line, $pragmas ) = @_;</td></tr>
<tr><td class="h">480</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return {</td></tr>
<tr><td class="h">481</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;pragma&#39;,</td></tr>
<tr><td class="h">482</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $line,</td></tr>
<tr><td class="h">483</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pragmas =&gt; [ split /\s*,\s*/, _trim($pragmas) ],</td></tr>
<tr><td class="h">484</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">485</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">486</td><td colspan="7"></td></tr><tr><td class="h">487</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _trim {</td></tr>
<tr><td class="h">488</td><td><div class="c3">2147</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Grammar-pm--subroutine.html#L488">2147</a></div></td><td></td><td><div>2159</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $data = shift;</td></tr>
<tr><td class="h">489</td><td colspan="7"></td></tr><tr><td class="h">490</td><td><div class="c3">2147</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Grammar-pm--branch.html#L490">100</a></div></td><td></td><td></td><td></td><td><div>4511</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless defined $data;</td></tr>
<tr><td class="h">491</td><td colspan="7"></td></tr><tr><td class="h">492</td><td><div class="c3">954</div></td><td></td><td></td><td></td><td></td><td><div>1845</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$data =~ s/^\s+//;</td></tr>
<tr><td class="h">493</td><td><div class="c3">954</div></td><td></td><td></td><td></td><td></td><td><div>1212</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$data =~ s/\s+$//;</td></tr>
<tr><td class="h">494</td><td><div class="c3">954</div></td><td></td><td></td><td></td><td></td><td><div>3099</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $data;</td></tr>
<tr><td class="h">495</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">496</td><td colspan="7"></td></tr><tr><td class="h">497</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
<tr><td class="h">498</td><td colspan="7"></td></tr><tr><td class="h">499 - 584</td><td colspan="6"></td><td class="s"><pre>=head1 TAP GRAMMAR

B&lt;NOTE:&gt;&nbsp;&nbsp;This grammar is slightly out of date.&nbsp;&nbsp;There&#39;s still some discussion
about it and a new one will be provided when we have things better defined.

The L&lt;TAP::Parser&gt; does not use a formal grammar because TAP is essentially a
stream-based protocol.&nbsp;&nbsp;In fact, it&#39;s quite legal to have an infinite stream.
For the same reason that we don&#39;t apply regexes to streams, we&#39;re not using a
formal grammar here.&nbsp;&nbsp;Instead, we parse the TAP in lines.

For purposes for forward compatibility, any result which does not match the
following grammar is currently referred to as
L&lt;TAP::Parser::Result::Unknown&gt;.&nbsp;&nbsp;It is I&lt;not&gt; a parse error.

A formal grammar would look similar to the following:

 (*
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For the time being, I&#39;m cheating on the EBNF by allowing
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;certain terms to be defined by POSIX character classes by
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using the following syntax:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digit ::= [:digit:]

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As far as I am aware, that&#39;s not valid EBNF.&nbsp;&nbsp;Sue me.&nbsp;&nbsp;I
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;didn&#39;t know how to write &quot;char&quot; otherwise (Unicode issues).
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Suggestions welcome.
 *)

 tap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= version? { comment | unknown } leading_plan lines
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines trailing_plan {comment}

 version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= &#39;TAP version &#39; positiveInteger {positiveInteger} &quot;\n&quot;

 leading_plan&nbsp;&nbsp;&nbsp;::= plan skip_directive? &quot;\n&quot;

 trailing_plan&nbsp;&nbsp;::= plan &quot;\n&quot;

 plan&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= &#39;1..&#39; nonNegativeInteger

 lines&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= line {line}

 line&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= (comment | test | unknown | bailout ) &quot;\n&quot;

 test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= status positiveInteger? description? directive?

 status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= &#39;not &#39;? &#39;ok &#39;

 description&nbsp;&nbsp;&nbsp;&nbsp;::= (character - (digit | &#39;#&#39;)) {character - &#39;#&#39;}

 directive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= todo_directive | skip_directive

 todo_directive ::= hash_mark &#39;TODO&#39; &#39; &#39; {character}

 skip_directive ::= hash_mark &#39;SKIP&#39; &#39; &#39; {character}

 comment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= hash_mark {character}

 hash_mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= &#39;#&#39; {&#39; &#39;}

 bailout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= &#39;Bail out!&#39; {character}

 unknown&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= { (character - &quot;\n&quot;) }

 (* POSIX character classes and other terminals *)

 digit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= [:digit:]
 character&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= ([:print:] - &quot;\n&quot;)
 positiveInteger&nbsp;&nbsp;&nbsp;&nbsp;::= ( digit - &#39;0&#39; ) {digit}
 nonNegativeInteger ::= digit {digit}

=head1 SUBCLASSING

Please see L&lt;TAP::Parser/SUBCLASSING&gt; for a subclassing overview.

If you I&lt;really&gt; want to subclass L&lt;TAP::Parser&gt;&#39;s grammar the best thing to
do is read through the code.&nbsp;&nbsp;There&#39;s no easy way of summarizing it here.

=head1 SEE ALSO

L&lt;TAP::Object&gt;,
L&lt;TAP::Parser&gt;,
L&lt;TAP::Parser::Iterator&gt;,
L&lt;TAP::Parser::Result&gt;,

=cut</pre></td></tr>
</table>
</body>
</html>
