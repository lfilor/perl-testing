<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.36
Devel::Cover is copyright 2001-2019, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: blib/lib/TAP/Parser/Source.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">blib/lib/TAP/Parser/Source.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c2">91.2%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package TAP::Parser::Source;</td></tr>
<tr><td class="h">2</td><td colspan="7"></td></tr><tr><td class="h">3</td><td><div class="c3">39</div><div class="c3">39</div><div class="c3">39</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L3">39</a></div></td><td></td><td><div>197144</div><div>103</div><div>541</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">4</td><td><div class="c3">39</div><div class="c3">39</div><div class="c3">39</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L4">39</a></div></td><td></td><td><div>64</div><div>46</div><div>691</div></td><td class="s">use warnings;</td></tr>
<tr><td class="h">5</td><td colspan="7"></td></tr><tr><td class="h">6</td><td><div class="c3">39</div><div class="c3">39</div><div class="c3">39</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L6">39</a></div></td><td></td><td><div>91</div><div>29</div><div>1631</div></td><td class="s">use File::Basename qw( fileparse );</td></tr>
<tr><td class="h">7</td><td><div class="c3">39</div><div class="c3">39</div><div class="c3">39</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L7">39</a></div></td><td></td><td><div>92</div><div>29</div><div>2476</div></td><td class="s">use base &#39;TAP::Object&#39;;</td></tr>
<tr><td class="h">8</td><td colspan="7"></td></tr><tr><td class="h">9</td><td><div class="c3">39</div><div class="c3">39</div><div class="c3">39</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L9">39</a></div></td><td></td><td><div>97</div><div>79</div><div>22808</div></td><td class="s">use constant BLK_SIZE =&gt; 512;</td></tr>
<tr><td class="h">10</td><td colspan="7"></td></tr><tr><td class="h">11 - 19</td><td colspan="6"></td><td class="s"><pre>=head1 NAME

TAP::Parser::Source - a TAP source &amp; meta data about it

=head1 VERSION

Version 3.42

=cut</pre></td></tr>
<tr><td class="h">20</td><td colspan="7"></td></tr><tr><td class="h">21</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &#39;3.42&#39;;</td></tr>
<tr><td class="h">22</td><td colspan="7"></td></tr><tr><td class="h">23 - 60</td><td colspan="6"></td><td class="s"><pre>=head1 SYNOPSIS

&nbsp;&nbsp;use TAP::Parser::Source;
&nbsp;&nbsp;my $source = TAP::Parser::Source-&gt;new;
&nbsp;&nbsp;$source-&gt;raw( \&#39;reference to raw TAP source&#39; )
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;config( \%config )
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;merge( $boolean )
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;switches( \@switches )
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;test_args( \@args )
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;assemble_meta;

&nbsp;&nbsp;do { ... } if $source-&gt;meta-&gt;{is_file};
&nbsp;&nbsp;# see assemble_meta for a full list of data available

=head1 DESCRIPTION

A TAP I&lt;source&gt; is something that produces a stream of TAP for the parser to
consume, such as an executable file, a text file, an archive, an IO handle, a
database, etc.&nbsp;&nbsp;C&lt;TAP::Parser::Source&gt;s encapsulate these I&lt;raw&gt; sources, and
provide some useful meta data about them.&nbsp;&nbsp;They are used by
L&lt;TAP::Parser::SourceHandler&gt;s, which do whatever is required to produce &amp;
capture a stream of TAP from the I&lt;raw&gt; source, and package it up in a
L&lt;TAP::Parser::Iterator&gt; for the parser to consume.

Unless you&#39;re writing a new L&lt;TAP::Parser::SourceHandler&gt;, a plugin or
subclassing L&lt;TAP::Parser&gt;, you probably won&#39;t need to use this module directly.

=head1 METHODS

=head2 Class Methods

=head3 C&lt;new&gt;

 my $source = TAP::Parser::Source-&gt;new;

Returns a new C&lt;TAP::Parser::Source&gt; object.

=cut</pre></td></tr>
<tr><td class="h">61</td><td colspan="7"></td></tr><tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># new() implementation supplied by TAP::Object</td></tr>
<tr><td class="h">63</td><td colspan="7"></td></tr><tr><td class="h">64</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _initialize {</td></tr>
<tr><td class="h">65</td><td><div class="c3">362</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L65">362</a></div></td><td></td><td><div>358</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self) = @_;</td></tr>
<tr><td class="h">66</td><td><div class="c3">362</div></td><td></td><td></td><td></td><td></td><td><div>660</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;meta(&nbsp;&nbsp;&nbsp;{} );</td></tr>
<tr><td class="h">67</td><td><div class="c3">362</div></td><td></td><td></td><td></td><td></td><td><div>484</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;config( {} );</td></tr>
<tr><td class="h">68</td><td><div class="c3">362</div></td><td></td><td></td><td></td><td></td><td><div>453</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self;</td></tr>
<tr><td class="h">69</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">70</td><td colspan="7"></td></tr><tr><td class="h">71</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">##############################################################################</td></tr>
<tr><td class="h">72</td><td colspan="7"></td></tr><tr><td class="h">73 - 128</td><td colspan="6"></td><td class="s"><pre>=head2 Instance Methods

=head3 C&lt;raw&gt;

&nbsp;&nbsp;my $raw = $source-&gt;raw;
&nbsp;&nbsp;$source-&gt;raw( $some_value );

Chaining getter/setter for the raw TAP source.&nbsp;&nbsp;This is a reference, as it may
contain large amounts of data (eg: raw TAP).

=head3 C&lt;meta&gt;

&nbsp;&nbsp;my $meta = $source-&gt;meta;
&nbsp;&nbsp;$source-&gt;meta({ %some_value });

Chaining getter/setter for meta data about the source.&nbsp;&nbsp;This defaults to an
empty hashref.&nbsp;&nbsp;See L&lt;/assemble_meta&gt; for more info.

=head3 C&lt;has_meta&gt;

True if the source has meta data.

=head3 C&lt;config&gt;

&nbsp;&nbsp;my $config = $source-&gt;config;
&nbsp;&nbsp;$source-&gt;config({ %some_value });

Chaining getter/setter for the source&#39;s configuration, if any has been provided
by the user.&nbsp;&nbsp;How it&#39;s used is up to you.&nbsp;&nbsp;This defaults to an empty hashref.
See L&lt;/config_for&gt; for more info.

=head3 C&lt;merge&gt;

&nbsp;&nbsp;my $merge = $source-&gt;merge;
&nbsp;&nbsp;$source-&gt;config( $bool );

Chaining getter/setter for the flag that dictates whether STDOUT and STDERR
should be merged (where appropriate).&nbsp;&nbsp;Defaults to undef.

=head3 C&lt;switches&gt;

&nbsp;&nbsp;my $switches = $source-&gt;switches;
&nbsp;&nbsp;$source-&gt;config([ @switches ]);

Chaining getter/setter for the list of command-line switches that should be
passed to the source (where appropriate).&nbsp;&nbsp;Defaults to undef.

=head3 C&lt;test_args&gt;

&nbsp;&nbsp;my $test_args = $source-&gt;test_args;
&nbsp;&nbsp;$source-&gt;config([ @test_args ]);

Chaining getter/setter for the list of command-line arguments that should be
passed to the source (where appropriate).&nbsp;&nbsp;Defaults to undef.

=cut</pre></td></tr>
<tr><td class="h">129</td><td colspan="7"></td></tr><tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub raw {</td></tr>
<tr><td class="h">131</td><td><div class="c3">2398</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L131">2398</a></div></td><td><div class="c3">1</div></td><td><div>2786</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">132</td><td><div class="c3">2398</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L132">100</a></div></td><td></td><td></td><td></td><td><div>3291</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{raw} unless @_;</td></tr>
<tr><td class="h">133</td><td><div class="c3">333</div></td><td></td><td></td><td></td><td></td><td><div>331</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{raw} = shift;</td></tr>
<tr><td class="h">134</td><td><div class="c3">333</div></td><td></td><td></td><td></td><td></td><td><div>286</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self;</td></tr>
<tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">136</td><td colspan="7"></td></tr><tr><td class="h">137</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub meta {</td></tr>
<tr><td class="h">138</td><td><div class="c3">3424</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L138">3424</a></div></td><td><div class="c3">1</div></td><td><div>2704</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">139</td><td><div class="c3">3424</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L139">100</a></div></td><td></td><td></td><td></td><td><div>4127</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{meta} unless @_;</td></tr>
<tr><td class="h">140</td><td><div class="c3">375</div></td><td></td><td></td><td></td><td></td><td><div>507</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{meta} = shift;</td></tr>
<tr><td class="h">141</td><td><div class="c3">375</div></td><td></td><td></td><td></td><td></td><td><div>339</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self;</td></tr>
<tr><td class="h">142</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">143</td><td colspan="7"></td></tr><tr><td class="h">144</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub has_meta {</td></tr>
<tr><td class="h">145</td><td><div class="c3">329</div><div class="c3">329</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L145">50</a></div></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L145">329</a></div></td><td><div class="c3">1</div></td><td><div>238</div><div>289</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return scalar %{ shift-&gt;meta } ? 1 : 0;</td></tr>
<tr><td class="h">146</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">147</td><td colspan="7"></td></tr><tr><td class="h">148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub config {</td></tr>
<tr><td class="h">149</td><td><div class="c3">1320</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L149">1320</a></div></td><td><div class="c3">1</div></td><td><div>1328</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">150</td><td><div class="c3">1320</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L150">100</a></div></td><td></td><td></td><td></td><td><div>1976</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{config} unless @_;</td></tr>
<tr><td class="h">151</td><td><div class="c3">671</div></td><td></td><td></td><td></td><td></td><td><div>731</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{config} = shift;</td></tr>
<tr><td class="h">152</td><td><div class="c3">671</div></td><td></td><td></td><td></td><td></td><td><div>883</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self;</td></tr>
<tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">154</td><td colspan="7"></td></tr><tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub merge {</td></tr>
<tr><td class="h">156</td><td><div class="c3">521</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L156">521</a></div></td><td><div class="c3">1</div></td><td><div>357</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">157</td><td><div class="c3">521</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L157">100</a></div></td><td></td><td></td><td></td><td><div>1689</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{merge} unless @_;</td></tr>
<tr><td class="h">158</td><td><div class="c3">294</div></td><td></td><td></td><td></td><td></td><td><div>282</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{merge} = shift;</td></tr>
<tr><td class="h">159</td><td><div class="c3">294</div></td><td></td><td></td><td></td><td></td><td><div>406</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self;</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">161</td><td colspan="7"></td></tr><tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub switches {</td></tr>
<tr><td class="h">163</td><td><div class="c3">508</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L163">508</a></div></td><td><div class="c3">1</div></td><td><div>391</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">164</td><td><div class="c3">508</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L164">100</a></div></td><td></td><td></td><td></td><td><div>1029</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{switches} unless @_;</td></tr>
<tr><td class="h">165</td><td><div class="c3">294</div></td><td></td><td></td><td></td><td></td><td><div>250</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{switches} = shift;</td></tr>
<tr><td class="h">166</td><td><div class="c3">294</div></td><td></td><td></td><td></td><td></td><td><div>421</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self;</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">168</td><td colspan="7"></td></tr><tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub test_args {</td></tr>
<tr><td class="h">170</td><td><div class="c3">522</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L170">522</a></div></td><td><div class="c3">1</div></td><td><div>476</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">171</td><td><div class="c3">522</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L171">100</a></div></td><td></td><td></td><td></td><td><div>733</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{test_args} unless @_;</td></tr>
<tr><td class="h">172</td><td><div class="c3">295</div></td><td></td><td></td><td></td><td></td><td><div>323</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{test_args} = shift;</td></tr>
<tr><td class="h">173</td><td><div class="c3">295</div></td><td></td><td></td><td></td><td></td><td><div>263</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self;</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">175</td><td colspan="7"></td></tr><tr><td class="h">176 - 227</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;assemble_meta&gt;

&nbsp;&nbsp;my $meta = $source-&gt;assemble_meta;

Gathers meta data about the L&lt;/raw&gt; source, stashes it in L&lt;/meta&gt; and returns
it as a hashref.&nbsp;&nbsp;This is done so that the L&lt;TAP::Parser::SourceHandler&gt;s don&#39;t
have to repeat common checks.&nbsp;&nbsp;Currently this includes:

&nbsp;&nbsp;&nbsp;&nbsp;is_scalar =&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;is_hash&nbsp;&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;is_array&nbsp;&nbsp;=&gt; $bool,

&nbsp;&nbsp;&nbsp;&nbsp;# for scalars:
&nbsp;&nbsp;&nbsp;&nbsp;length =&gt; $n
&nbsp;&nbsp;&nbsp;&nbsp;has_newlines =&gt; $bool

&nbsp;&nbsp;&nbsp;&nbsp;# only done if the scalar looks like a filename
&nbsp;&nbsp;&nbsp;&nbsp;is_file =&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;is_dir&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;is_symlink =&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;file =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# only done if the scalar looks like a filename
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basename =&gt; $string, # including ext
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $string,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ext&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $string,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lc_ext&nbsp;&nbsp;&nbsp;=&gt; $string,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# system checks
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stat&nbsp;&nbsp;&nbsp;&nbsp;=&gt; [ ... ], # perldoc -f stat
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty&nbsp;&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $n,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binary&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write&nbsp;&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute =&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setuid&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setgid&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sticky&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_file =&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_dir&nbsp;&nbsp;=&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_symlink =&gt; $bool,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# only done if the file&#39;s a symlink
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lstat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; [ ... ], # perldoc -f lstat
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# only done if the file&#39;s a readable text file
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shebang =&gt; $first_line,
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;# for arrays:
&nbsp;&nbsp;size =&gt; $n,

=cut</pre></td></tr>
<tr><td class="h">228</td><td colspan="7"></td></tr><tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub assemble_meta {</td></tr>
<tr><td class="h">230</td><td><div class="c3">329</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L230">329</a></div></td><td><div class="c3">1</div></td><td><div>436</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self) = @_;</td></tr>
<tr><td class="h">231</td><td colspan="7"></td></tr><tr><td class="h">232</td><td><div class="c3">329</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L232">50</a></div></td><td></td><td></td><td></td><td><div>388</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;meta if $self-&gt;has_meta;</td></tr>
<tr><td class="h">233</td><td colspan="7"></td></tr><tr><td class="h">234</td><td><div class="c3">329</div></td><td></td><td></td><td></td><td></td><td><div>312</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta = $self-&gt;meta;</td></tr>
<tr><td class="h">235</td><td><div class="c3">329</div></td><td></td><td></td><td></td><td></td><td><div>416</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $raw&nbsp;&nbsp;= $self-&gt;raw;</td></tr>
<tr><td class="h">236</td><td colspan="7"></td></tr><tr><td class="h">237</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# rudimentary is object test - if it&#39;s blessed it&#39;ll</td></tr>
<tr><td class="h">238</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# inherit from UNIVERSAL</td></tr>
<tr><td class="h">239</td><td><div class="c3">329</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L239">100</a></div></td><td></td><td></td><td></td><td><div>710</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{is_object} = UNIVERSAL::isa( $raw, &#39;UNIVERSAL&#39; ) ? 1 : 0;</td></tr>
<tr><td class="h">240</td><td colspan="7"></td></tr><tr><td class="h">241</td><td><div class="c3">329</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L241">100</a></div></td><td></td><td></td><td></td><td><div>384</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $meta-&gt;{is_object} ) {</td></tr>
<tr><td class="h">242</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{class} = ref($raw);</td></tr>
<tr><td class="h">243</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">244</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">245</td><td><div class="c3">325</div></td><td></td><td></td><td></td><td></td><td><div>510</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ref = lc( ref($raw) );</td></tr>
<tr><td class="h">246</td><td><div class="c3">325</div></td><td></td><td></td><td></td><td></td><td><div>517</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{&quot;is_$ref&quot;} = 1;</td></tr>
<tr><td class="h">247</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">248</td><td colspan="7"></td></tr><tr><td class="h">249</td><td><div class="c3">329</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L249">100</a></div><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L249">100</a></div><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L249">100</a></div></td><td></td><td></td><td></td><td><div>401</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $meta-&gt;{is_scalar} ) {</td></tr>
<tr><td class="h">250</td><td><div class="c3">299</div></td><td></td><td></td><td></td><td></td><td><div>299</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $source = $$raw;</td></tr>
<tr><td class="h">251</td><td><div class="c3">299</div></td><td></td><td></td><td></td><td></td><td><div>394</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{length} = length($$raw);</td></tr>
<tr><td class="h">252</td><td><div class="c3">299</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L252">100</a></div></td><td></td><td></td><td></td><td><div>617</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{has_newlines} = $$raw =~ /\n/ ? 1 : 0;</td></tr>
<tr><td class="h">253</td><td colspan="7"></td></tr><tr><td class="h">254</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# only do file checks if it looks like a filename</td></tr>
<tr><td class="h">255</td><td><div class="c3">299</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L255">100</a></div></td><td><div class="c0"><a href="blib-lib-TAP-Parser-Source-pm--condition.html#L255">67</a></div></td><td></td><td></td><td><div>991</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( !$meta-&gt;{has_newlines} and $meta-&gt;{length} &lt; 1024 ) {</td></tr>
<tr><td class="h">256</td><td><div class="c3">233</div></td><td></td><td></td><td></td><td></td><td><div>188</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $file = {};</td></tr>
<tr><td class="h">257</td><td><div class="c3">233</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L257">100</a></div></td><td></td><td></td><td></td><td><div>1513</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{exists} = -e $source ? 1 : 0;</td></tr>
<tr><td class="h">258</td><td><div class="c3">233</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L258">100</a></div></td><td></td><td></td><td></td><td><div>268</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $file-&gt;{exists} ) {</td></tr>
<tr><td class="h">259</td><td><div class="c3">229</div></td><td></td><td></td><td></td><td></td><td><div>208</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{file} = $file;</td></tr>
<tr><td class="h">260</td><td colspan="7"></td></tr><tr><td class="h">261</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# avoid extra system calls (see `perldoc -f -X`)</td></tr>
<tr><td class="h">262</td><td><div class="c3">229</div></td><td></td><td></td><td></td><td></td><td><div>490</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{stat}&nbsp;&nbsp;&nbsp;&nbsp;= [ stat(_) ];</td></tr>
<tr><td class="h">263</td><td><div class="c3">229</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L263">50</a></div></td><td></td><td></td><td></td><td><div>399</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{empty}&nbsp;&nbsp;&nbsp;= -z _ ? 1 : 0;</td></tr>
<tr><td class="h">264</td><td><div class="c3">229</div></td><td></td><td></td><td></td><td></td><td><div>336</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{size}&nbsp;&nbsp;&nbsp;&nbsp;= -s _;</td></tr>
<tr><td class="h">265</td><td><div class="c3">229</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L265">100</a></div></td><td></td><td></td><td></td><td><div>3448</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{text}&nbsp;&nbsp;&nbsp;&nbsp;= -T _ ? 1 : 0;</td></tr>
<tr><td class="h">266</td><td><div class="c3">229</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L266">100</a></div></td><td></td><td></td><td></td><td><div>1352</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{binary}&nbsp;&nbsp;= -B _ ? 1 : 0;</td></tr>
<tr><td class="h">267</td><td><div class="c3">229</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L267">50</a></div></td><td></td><td></td><td></td><td><div>447</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{read}&nbsp;&nbsp;&nbsp;&nbsp;= -r _ ? 1 : 0;</td></tr>
<tr><td class="h">268</td><td><div class="c3">229</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L268">50</a></div></td><td></td><td></td><td></td><td><div>426</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{write}&nbsp;&nbsp;&nbsp;= -w _ ? 1 : 0;</td></tr>
<tr><td class="h">269</td><td><div class="c3">229</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L269">100</a></div></td><td></td><td></td><td></td><td><div>316</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{execute} = -x _ ? 1 : 0;</td></tr>
<tr><td class="h">270</td><td><div class="c3">229</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L270">50</a></div></td><td></td><td></td><td></td><td><div>347</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{setuid}&nbsp;&nbsp;= -u _ ? 1 : 0;</td></tr>
<tr><td class="h">271</td><td><div class="c3">229</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L271">50</a></div></td><td></td><td></td><td></td><td><div>450</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{setgid}&nbsp;&nbsp;= -g _ ? 1 : 0;</td></tr>
<tr><td class="h">272</td><td><div class="c3">229</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L272">50</a></div></td><td></td><td></td><td></td><td><div>279</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{sticky}&nbsp;&nbsp;= -k _ ? 1 : 0;</td></tr>
<tr><td class="h">273</td><td colspan="7"></td></tr><tr><td class="h">274</td><td><div class="c3">229</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L274">100</a></div></td><td></td><td></td><td></td><td><div>426</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{is_file} = $file-&gt;{is_file} = -f _ ? 1 : 0;</td></tr>
<tr><td class="h">275</td><td><div class="c3">229</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L275">100</a></div></td><td></td><td></td><td></td><td><div>277</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{is_dir}&nbsp;&nbsp;= $file-&gt;{is_dir}&nbsp;&nbsp;= -d _ ? 1 : 0;</td></tr>
<tr><td class="h">276</td><td colspan="7"></td></tr><tr><td class="h">277</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# symlink check requires another system call</td></tr>
<tr><td class="h">278</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{is_symlink} = $file-&gt;{is_symlink}</td></tr>
<tr><td class="h">279</td><td><div class="c3">229</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L279">100</a></div></td><td></td><td></td><td></td><td><div>606</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= -l $source ? 1 : 0;</td></tr>
<tr><td class="h">280</td><td><div class="c3">229</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L280">100</a></div></td><td></td><td></td><td></td><td><div>287</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $file-&gt;{is_symlink} ) {</td></tr>
<tr><td class="h">281</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{lstat} = [ lstat(_) ];</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">283</td><td colspan="7"></td></tr><tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# put together some common info about the file</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $file-&gt;{basename}, $file-&gt;{dir}, $file-&gt;{ext} )</td></tr>
<tr><td class="h">286</td><td><div class="c3">229</div><div class="c3">687</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L286">50</a></div></td><td></td><td></td><td></td><td><div>5503</div><div>984</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= map { defined $_ ? $_ : &#39;&#39; }</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fileparse( $source, qr/\.[^.]*/ );</td></tr>
<tr><td class="h">288</td><td><div class="c3">229</div></td><td></td><td></td><td></td><td></td><td><div>494</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{lc_ext} = lc( $file-&gt;{ext} );</td></tr>
<tr><td class="h">289</td><td><div class="c3">229</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L289">100</a></div></td><td></td><td></td><td></td><td><div>294</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file-&gt;{basename} .= $file-&gt;{ext} if $file-&gt;{ext};</td></tr>
<tr><td class="h">290</td><td colspan="7"></td></tr><tr><td class="h">291</td><td><div class="c3">229</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L291">50</a></div></td><td><div class="c0"><a href="blib-lib-TAP-Parser-Source-pm--condition.html#L291">67</a></div></td><td></td><td></td><td><div>807</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( !$file-&gt;{is_dir} &amp;&amp; $file-&gt;{read} ) {</td></tr>
<tr><td class="h">292</td><td><div class="c3">228</div><div class="c3">228</div></td><td></td><td></td><td></td><td></td><td><div>177</div><div>379</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval { $file-&gt;{shebang} = $self-&gt;shebang($$raw); };</td></tr>
<tr><td class="h">293</td><td><div class="c3">228</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L293">50</a></div></td><td></td><td></td><td></td><td><div>521</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( my $e = $@ ) {</td></tr>
<tr><td class="h">294</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn $e;</td></tr>
<tr><td class="h">295</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">296</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">297</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">298</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">299</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">300</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $meta-&gt;{is_array} ) {</td></tr>
<tr><td class="h">301</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;{size} = $#$raw + 1;</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">303</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $meta-&gt;{is_hash} ) {</td></tr>
<tr><td class="h">304</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;# do nothing</td></tr>
<tr><td class="h">305</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">306</td><td colspan="7"></td></tr><tr><td class="h">307</td><td><div class="c3">329</div></td><td></td><td></td><td></td><td></td><td><div>401</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $meta;</td></tr>
<tr><td class="h">308</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">309</td><td colspan="7"></td></tr><tr><td class="h">310 - 318</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;shebang&gt;

Get the shebang line for a script file.

&nbsp;&nbsp;my $shebang = TAP::Parser::Source-&gt;shebang( $some_script );

May be called as a class method

=cut</pre></td></tr>
<tr><td class="h">319</td><td colspan="7"></td></tr><tr><td class="h">320</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">321</td><td colspan="7"></td></tr><tr><td class="h">322</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Global shebang cache.</td></tr>
<tr><td class="h">323</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %shebang_for;</td></tr>
<tr><td class="h">324</td><td colspan="7"></td></tr><tr><td class="h">325</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;sub _read_shebang {</td></tr>
<tr><td class="h">326</td><td><div class="c3">117</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L326">117</a></div></td><td></td><td><div>112</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $file ) = @_;</td></tr>
<tr><td class="h">327</td><td><div class="c3">117</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L327">50</a></div></td><td></td><td></td><td></td><td><div>1245</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open my $fh, &#39;&lt;&#39;, $file or die &quot;Can&#39;t read $file: $!\n&quot;;</td></tr>
<tr><td class="h">328</td><td colspan="7"></td></tr><tr><td class="h">329</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Might be a binary file - so read a fixed number of bytes.</td></tr>
<tr><td class="h">330</td><td><div class="c3">117</div></td><td></td><td></td><td></td><td></td><td><div>445</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $got = read $fh, my ($buf), BLK_SIZE;</td></tr>
<tr><td class="h">331</td><td><div class="c3">117</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L331">50</a></div></td><td></td><td></td><td></td><td><div>189</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defined $got or die &quot;I/O error: $!\n&quot;;</td></tr>
<tr><td class="h">332</td><td><div class="c3">117</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L332">50</a></div></td><td></td><td></td><td></td><td><div>833</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $1 if $buf =~ /(.*)/;</td></tr>
<tr><td class="h">333</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">335</td><td colspan="7"></td></tr><tr><td class="h">336</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;sub shebang {</td></tr>
<tr><td class="h">337</td><td><div class="c3">228</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L337">228</a></div></td><td><div class="c3">1</div></td><td><div>283</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $file ) = @_;</td></tr>
<tr><td class="h">338</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shebang_for{$file} = $class-&gt;_read_shebang($file)</td></tr>
<tr><td class="h">339</td><td><div class="c3">228</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-Source-pm--branch.html#L339">100</a></div></td><td></td><td></td><td></td><td><div>401</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless exists $shebang_for{$file};</td></tr>
<tr><td class="h">340</td><td><div class="c3">228</div></td><td></td><td></td><td></td><td></td><td><div>396</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $shebang_for{$file};</td></tr>
<tr><td class="h">341</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">343</td><td colspan="7"></td></tr><tr><td class="h">344 - 357</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;config_for&gt;

&nbsp;&nbsp;my $config = $source-&gt;config_for( $class );

Returns L&lt;/config&gt; for the $class given.&nbsp;&nbsp;Class names may be fully qualified
or abbreviated, eg:

&nbsp;&nbsp;# these are equivalent
&nbsp;&nbsp;$source-&gt;config_for( &#39;Perl&#39; );
&nbsp;&nbsp;$source-&gt;config_for( &#39;TAP::Parser::SourceHandler::Perl&#39; );

If a fully qualified $class is given, its abbreviated version is checked first.

=cut</pre></td></tr>
<tr><td class="h">358</td><td colspan="7"></td></tr><tr><td class="h">359</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub config_for {</td></tr>
<tr><td class="h">360</td><td><div class="c3">328</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-Source-pm--subroutine.html#L360">328</a></div></td><td><div class="c3">1</div></td><td><div>306</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $class ) = @_;</td></tr>
<tr><td class="h">361</td><td><div class="c3">328</div></td><td></td><td></td><td></td><td></td><td><div>2476</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($abbrv_class) = ( $class =~ /(?:\:\:)?(\w+)$/ );</td></tr>
<tr><td class="h">362</td><td><div class="c3">328</div></td><td></td><td><div class="c0"><a href="blib-lib-TAP-Parser-Source-pm--condition.html#L362">67</a></div></td><td></td><td></td><td><div>315</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $config = $self-&gt;config-&gt;{$abbrv_class} || $self-&gt;config-&gt;{$class};</td></tr>
<tr><td class="h">363</td><td><div class="c3">328</div></td><td></td><td></td><td></td><td></td><td><div>402</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $config;</td></tr>
<tr><td class="h">364</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">365</td><td colspan="7"></td></tr><tr><td class="h">366</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
<tr><td class="h">367</td><td colspan="7"></td></tr></table>
</body>
</html>
