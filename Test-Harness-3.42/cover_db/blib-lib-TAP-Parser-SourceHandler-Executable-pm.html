<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.36
Devel::Cover is copyright 2001-2019, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: blib/lib/TAP/Parser/SourceHandler/Executable.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">blib/lib/TAP/Parser/SourceHandler/Executable.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c2">95.3%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package TAP::Parser::SourceHandler::Executable;</td></tr>
<tr><td class="h">2</td><td colspan="7"></td></tr><tr><td class="h">3</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L3">38</a></div></td><td></td><td><div>1653</div><div>31</div><div>545</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">4</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L4">38</a></div></td><td></td><td><div>82</div><div>61</div><div>606</div></td><td class="s">use warnings;</td></tr>
<tr><td class="h">5</td><td colspan="7"></td></tr><tr><td class="h">6</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L6">38</a></div></td><td></td><td><div>317</div><div>30</div><div>199</div></td><td class="s">use TAP::Parser::IteratorFactory&nbsp;&nbsp;&nbsp;();</td></tr>
<tr><td class="h">7</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L7">38</a></div></td><td></td><td><div>4806</div><div>36</div><div>665</div></td><td class="s">use TAP::Parser::Iterator::Process ();</td></tr>
<tr><td class="h">8</td><td colspan="7"></td></tr><tr><td class="h">9</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L9">38</a></div></td><td></td><td><div>79</div><div>51</div><div>7117</div></td><td class="s">use base &#39;TAP::Parser::SourceHandler&#39;;</td></tr>
<tr><td class="h">10</td><td colspan="7"></td></tr><tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">TAP::Parser::IteratorFactory-&gt;register_handler(__PACKAGE__);</td></tr>
<tr><td class="h">12</td><td colspan="7"></td></tr><tr><td class="h">13 - 21</td><td colspan="6"></td><td class="s"><pre>=head1 NAME

TAP::Parser::SourceHandler::Executable - Stream output from an executable TAP source

=head1 VERSION

Version 3.42

=cut</pre></td></tr>
<tr><td class="h">22</td><td colspan="7"></td></tr><tr><td class="h">23</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &#39;3.42&#39;;</td></tr>
<tr><td class="h">24</td><td colspan="7"></td></tr><tr><td class="h">25 - 64</td><td colspan="6"></td><td class="s"><pre>=head1 SYNOPSIS

&nbsp;&nbsp;use TAP::Parser::Source;
&nbsp;&nbsp;use TAP::Parser::SourceHandler::Executable;

&nbsp;&nbsp;my $source = TAP::Parser::Source-&gt;new-&gt;raw([&#39;/usr/bin/ruby&#39;, &#39;mytest.rb&#39;]);
&nbsp;&nbsp;$source-&gt;assemble_meta;

&nbsp;&nbsp;my $class = &#39;TAP::Parser::SourceHandler::Executable&#39;;
&nbsp;&nbsp;my $vote&nbsp;&nbsp;= $class-&gt;can_handle( $source );
&nbsp;&nbsp;my $iter&nbsp;&nbsp;= $class-&gt;make_iterator( $source );

=head1 DESCRIPTION

This is an I&lt;executable&gt; L&lt;TAP::Parser::SourceHandler&gt; - it has 2 jobs:

1. Figure out if the L&lt;TAP::Parser::Source&gt; it&#39;s given is an executable
&nbsp;&nbsp;&nbsp;command (L&lt;/can_handle&gt;).

2. Creates an iterator for executable commands (L&lt;/make_iterator&gt;).

Unless you&#39;re writing a plugin or subclassing L&lt;TAP::Parser&gt;, you
probably won&#39;t need to use this module directly.

=head1 METHODS

=head2 Class Methods

=head3 C&lt;can_handle&gt;

&nbsp;&nbsp;my $vote = $class-&gt;can_handle( $source );

Only votes if $source looks like an executable file. Casts the
following votes:

&nbsp;&nbsp;0.9&nbsp;&nbsp;if it&#39;s a hash with an &#39;exec&#39; key
&nbsp;&nbsp;0.8&nbsp;&nbsp;if it&#39;s a .bat file
&nbsp;&nbsp;0.75 if it&#39;s got an execute bit set

=cut</pre></td></tr>
<tr><td class="h">65</td><td colspan="7"></td></tr><tr><td class="h">66</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub can_handle {</td></tr>
<tr><td class="h">67</td><td><div class="c3">310</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L67">310</a></div></td><td><div class="c3">1</div></td><td><div>562</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $src ) = @_;</td></tr>
<tr><td class="h">68</td><td><div class="c3">310</div></td><td></td><td></td><td></td><td></td><td><div>384</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta = $src-&gt;meta;</td></tr>
<tr><td class="h">69</td><td colspan="7"></td></tr><tr><td class="h">70</td><td><div class="c3">310</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L70">100</a></div><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L70">100</a></div></td><td></td><td></td><td></td><td><div>408</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $meta-&gt;{is_file} ) {</td></tr>
<tr><td class="h">71</td><td><div class="c3">224</div></td><td></td><td></td><td></td><td></td><td><div>359</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $file = $meta-&gt;{file};</td></tr>
<tr><td class="h">72</td><td colspan="7"></td></tr><tr><td class="h">73</td><td><div class="c3">224</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L73">50</a></div></td><td><div class="c0"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--condition.html#L73">67</a></div></td><td></td><td></td><td><div>436</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0.85 if $file-&gt;{execute} &amp;&amp; $file-&gt;{binary};</td></tr>
<tr><td class="h">74</td><td><div class="c3">224</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L74">100</a></div></td><td></td><td></td><td></td><td><div>402</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0.8 if $file-&gt;{lc_ext} eq &#39;.bat&#39;;</td></tr>
<tr><td class="h">75</td><td><div class="c3">222</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L75">100</a></div></td><td></td><td></td><td></td><td><div>369</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0.25 if $file-&gt;{execute};</td></tr>
<tr><td class="h">76</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">77</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $meta-&gt;{is_hash} ) {</td></tr>
<tr><td class="h">78</td><td><div class="c3">12</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L78">50</a></div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0.9 if $src-&gt;raw-&gt;{exec};</td></tr>
<tr><td class="h">79</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">80</td><td colspan="7"></td></tr><tr><td class="h">81</td><td><div class="c3">292</div></td><td></td><td></td><td></td><td></td><td><div>528</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">83</td><td colspan="7"></td></tr><tr><td class="h">84 - 99</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;make_iterator&gt;

&nbsp;&nbsp;my $iterator = $class-&gt;make_iterator( $source );

Returns a new L&lt;TAP::Parser::Iterator::Process&gt; for the source.
C&lt;$source-E&lt;gt&gt;raw&gt; must be in one of the following forms:

&nbsp;&nbsp;{ exec =&gt; [ @exec ] }

&nbsp;&nbsp;[ @exec ]

&nbsp;&nbsp;$file

C&lt;croak&gt;s on error.

=cut</pre></td></tr>
<tr><td class="h">100</td><td colspan="7"></td></tr><tr><td class="h">101</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub make_iterator {</td></tr>
<tr><td class="h">102</td><td><div class="c3">15</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L102">15</a></div></td><td><div class="c3">1</div></td><td><div>41</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $source ) = @_;</td></tr>
<tr><td class="h">103</td><td><div class="c3">15</div></td><td></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta = $source-&gt;meta;</td></tr>
<tr><td class="h">104</td><td colspan="7"></td></tr><tr><td class="h">105</td><td><div class="c3">15</div></td><td></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @command;</td></tr>
<tr><td class="h">106</td><td><div class="c3">15</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L106">100</a></div><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L106">100</a></div><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L106">100</a></div></td><td></td><td></td><td></td><td><div>54</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $meta-&gt;{is_hash} ) {</td></tr>
<tr><td class="h">107</td><td><div class="c3">11</div><div class="c3">11</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L107">50</a></div></td><td></td><td></td><td></td><td><div>21</div><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@command = @{ $source-&gt;raw-&gt;{exec} || [] };</td></tr>
<tr><td class="h">108</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $meta-&gt;{is_scalar} ) {</td></tr>
<tr><td class="h">110</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div><div>1</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@command = ${ $source-&gt;raw };</td></tr>
<tr><td class="h">111</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">112</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $meta-&gt;{is_array} ) {</td></tr>
<tr><td class="h">113</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div><div>1</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@command = @{ $source-&gt;raw };</td></tr>
<tr><td class="h">114</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">115</td><td colspan="7"></td></tr><tr><td class="h">116</td><td><div class="c3">15</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L116">100</a></div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_croak(&#39;No command found in $source-&gt;raw!&#39;) unless @command;</td></tr>
<tr><td class="h">117</td><td colspan="7"></td></tr><tr><td class="h">118</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_autoflush( \*STDOUT );</td></tr>
<tr><td class="h">119</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_autoflush( \*STDERR );</td></tr>
<tr><td class="h">120</td><td colspan="7"></td></tr><tr><td class="h">121</td><td><div class="c3">13</div><div class="c3">13</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--branch.html#L121">100</a></div></td><td></td><td></td><td></td><td><div>12</div><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @command, @{ $source-&gt;test_args || [] };</td></tr>
<tr><td class="h">122</td><td colspan="7"></td></tr><tr><td class="h">123</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>46</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $class-&gt;iterator_class-&gt;new(</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;command =&gt; \@command,</td></tr>
<tr><td class="h">125</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;merge&nbsp;&nbsp;&nbsp;=&gt; $source-&gt;merge</td></tr>
<tr><td class="h">126</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">128</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">129</td><td colspan="7"></td></tr><tr><td class="h">130 - 135</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;iterator_class&gt;

The class of iterator to use, override if you&#39;re sub-classing.&nbsp;&nbsp;Defaults
to L&lt;TAP::Parser::Iterator::Process&gt;.

=cut</pre></td></tr>
<tr><td class="h">136</td><td colspan="7"></td></tr><tr><td class="h">137</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L137">38</a></div></td><td></td><td><div>120</div><div>28</div><div>2215</div></td><td class="s">use constant iterator_class =&gt; &#39;TAP::Parser::Iterator::Process&#39;;</td></tr>
<tr><td class="h">138</td><td colspan="7"></td></tr><tr><td class="h">139</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Turns on autoflush for the handle passed</td></tr>
<tr><td class="h">140</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _autoflush {</td></tr>
<tr><td class="h">141</td><td><div class="c3">450</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Executable-pm--subroutine.html#L141">450</a></div></td><td></td><td><div>380</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $flushed ) = @_;</td></tr>
<tr><td class="h">142</td><td><div class="c3">450</div></td><td></td><td></td><td></td><td></td><td><div>729</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $old_fh = select $flushed;</td></tr>
<tr><td class="h">143</td><td><div class="c3">450</div></td><td></td><td></td><td></td><td></td><td><div>586</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$| = 1;</td></tr>
<tr><td class="h">144</td><td><div class="c3">450</div></td><td></td><td></td><td></td><td></td><td><div>657</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;select $old_fh;</td></tr>
<tr><td class="h">145</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">146</td><td colspan="7"></td></tr><tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
<tr><td class="h">148</td><td colspan="7"></td></tr><tr><td class="h">149 - 184</td><td colspan="6"></td><td class="s"><pre>=head1 SUBCLASSING

Please see L&lt;TAP::Parser/SUBCLASSING&gt; for a subclassing overview.

=head2 Example

&nbsp;&nbsp;package MyRubySourceHandler;

&nbsp;&nbsp;use strict;

&nbsp;&nbsp;use Carp qw( croak );
&nbsp;&nbsp;use TAP::Parser::SourceHandler::Executable;

&nbsp;&nbsp;use base &#39;TAP::Parser::SourceHandler::Executable&#39;;

&nbsp;&nbsp;# expect $handler-&gt;([&#39;mytest.rb&#39;, &#39;cmdline&#39;, &#39;args&#39;]);
&nbsp;&nbsp;sub make_iterator {
&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $source) = @_;
&nbsp;&nbsp;&nbsp;&nbsp;my @test_args = @{ $source-&gt;test_args };
&nbsp;&nbsp;&nbsp;&nbsp;my $rb_file&nbsp;&nbsp;&nbsp;= $test_args[0];
&nbsp;&nbsp;&nbsp;&nbsp;croak(&quot;error: Ruby file &#39;$rb_file&#39; not found!&quot;) unless (-f $rb_file);
&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;SUPER::raw_source([&#39;/usr/bin/ruby&#39;, @test_args]);
&nbsp;&nbsp;}

=head1 SEE ALSO

L&lt;TAP::Object&gt;,
L&lt;TAP::Parser&gt;,
L&lt;TAP::Parser::IteratorFactory&gt;,
L&lt;TAP::Parser::SourceHandler&gt;,
L&lt;TAP::Parser::SourceHandler::Perl&gt;,
L&lt;TAP::Parser::SourceHandler::File&gt;,
L&lt;TAP::Parser::SourceHandler::Handle&gt;,
L&lt;TAP::Parser::SourceHandler::RawTAP&gt;

=cut</pre></td></tr>
</table>
</body>
</html>
