<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.36
Devel::Cover is copyright 2001-2019, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: blib/lib/TAP/Parser/SourceHandler/Perl.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">blib/lib/TAP/Parser/SourceHandler/Perl.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c2">94.7%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package TAP::Parser::SourceHandler::Perl;</td></tr>
<tr><td class="h">2</td><td colspan="7"></td></tr><tr><td class="h">3</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L3">38</a></div></td><td></td><td><div>2792</div><div>46</div><div>431</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">4</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L4">38</a></div></td><td></td><td><div>77</div><div>27</div><div>551</div></td><td class="s">use warnings;</td></tr>
<tr><td class="h">5</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L5">38</a></div></td><td></td><td><div>81</div><div>24</div><div>1129</div></td><td class="s">use Config;</td></tr>
<tr><td class="h">6</td><td colspan="7"></td></tr><tr><td class="h">7</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L7">38</a></div></td><td></td><td><div>77</div><div>65</div><div>1171</div></td><td class="s">use constant IS_WIN32 =&gt; ( $^O =~ /^(MS)?Win32$/ );</td></tr>
<tr><td class="h">8</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L8">38</a></div></td><td></td><td><div>116</div><div>21</div><div>826</div></td><td class="s">use constant IS_VMS =&gt; ( $^O eq &#39;VMS&#39; );</td></tr>
<tr><td class="h">9</td><td colspan="7"></td></tr><tr><td class="h">10</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L10">38</a></div></td><td></td><td><div>1598</div><div>27</div><div>294</div></td><td class="s">use TAP::Parser::IteratorFactory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;();</td></tr>
<tr><td class="h">11</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L11">38</a></div></td><td></td><td><div>2274</div><div>48</div><div>437</div></td><td class="s">use TAP::Parser::Iterator::Process&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;();</td></tr>
<tr><td class="h">12</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L12">38</a></div></td><td></td><td><div>5403</div><div>28518</div><div>1248</div></td><td class="s">use Text::ParseWords qw(shellwords);</td></tr>
<tr><td class="h">13</td><td colspan="7"></td></tr><tr><td class="h">14</td><td><div class="c3">38</div><div class="c3">38</div><div class="c3">38</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L14">38</a></div></td><td></td><td><div>116</div><div>29</div><div>22723</div></td><td class="s">use base &#39;TAP::Parser::SourceHandler::Executable&#39;;</td></tr>
<tr><td class="h">15</td><td colspan="7"></td></tr><tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">TAP::Parser::IteratorFactory-&gt;register_handler(__PACKAGE__);</td></tr>
<tr><td class="h">17</td><td colspan="7"></td></tr><tr><td class="h">18 - 26</td><td colspan="6"></td><td class="s"><pre>=head1 NAME

TAP::Parser::SourceHandler::Perl - Stream TAP from a Perl executable

=head1 VERSION

Version 3.42

=cut</pre></td></tr>
<tr><td class="h">27</td><td colspan="7"></td></tr><tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &#39;3.42&#39;;</td></tr>
<tr><td class="h">29</td><td colspan="7"></td></tr><tr><td class="h">30 - 71</td><td colspan="6"></td><td class="s"><pre>=head1 SYNOPSIS

&nbsp;&nbsp;use TAP::Parser::Source;
&nbsp;&nbsp;use TAP::Parser::SourceHandler::Perl;

&nbsp;&nbsp;my $source = TAP::Parser::Source-&gt;new-&gt;raw( \&#39;script.pl&#39; );
&nbsp;&nbsp;$source-&gt;assemble_meta;

&nbsp;&nbsp;my $class = &#39;TAP::Parser::SourceHandler::Perl&#39;;
&nbsp;&nbsp;my $vote&nbsp;&nbsp;= $class-&gt;can_handle( $source );
&nbsp;&nbsp;my $iter&nbsp;&nbsp;= $class-&gt;make_iterator( $source );

=head1 DESCRIPTION

This is a I&lt;Perl&gt; L&lt;TAP::Parser::SourceHandler&gt; - it has 2 jobs:

1. Figure out if the L&lt;TAP::Parser::Source&gt; it&#39;s given is actually a Perl
script (L&lt;/can_handle&gt;).

2. Creates an iterator for Perl sources (L&lt;/make_iterator&gt;).

Unless you&#39;re writing a plugin or subclassing L&lt;TAP::Parser&gt;, you probably
won&#39;t need to use this module directly.

=head1 METHODS

=head2 Class Methods

=head3 C&lt;can_handle&gt;

&nbsp;&nbsp;my $vote = $class-&gt;can_handle( $source );

Only votes if $source looks like a file.&nbsp;&nbsp;Casts the following votes:

&nbsp;&nbsp;0.9&nbsp;&nbsp;if it has a shebang ala &quot;#!...perl&quot;
&nbsp;&nbsp;0.75 if it has any shebang
&nbsp;&nbsp;0.8&nbsp;&nbsp;if it&#39;s a .t file
&nbsp;&nbsp;0.9&nbsp;&nbsp;if it&#39;s a .pl file
&nbsp;&nbsp;0.75 if it&#39;s in a &#39;t&#39; directory
&nbsp;&nbsp;0.25 by default (backwards compat)

=cut</pre></td></tr>
<tr><td class="h">72</td><td colspan="7"></td></tr><tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub can_handle {</td></tr>
<tr><td class="h">74</td><td><div class="c3">313</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L74">313</a></div></td><td><div class="c3">1</div></td><td><div>409</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $source ) = @_;</td></tr>
<tr><td class="h">75</td><td><div class="c3">313</div></td><td></td><td></td><td></td><td></td><td><div>453</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta = $source-&gt;meta;</td></tr>
<tr><td class="h">76</td><td colspan="7"></td></tr><tr><td class="h">77</td><td><div class="c3">313</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L77">100</a></div></td><td></td><td></td><td></td><td><div>465</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0 unless $meta-&gt;{is_file};</td></tr>
<tr><td class="h">78</td><td><div class="c3">227</div></td><td></td><td></td><td></td><td></td><td><div>275</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file = $meta-&gt;{file};</td></tr>
<tr><td class="h">79</td><td colspan="7"></td></tr><tr><td class="h">80</td><td><div class="c3">227</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L80">100</a></div></td><td></td><td></td><td></td><td><div>332</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( my $shebang = $file-&gt;{shebang} ) {</td></tr>
<tr><td class="h">81</td><td><div class="c3">223</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L81">100</a></div></td><td></td><td></td><td></td><td><div>611</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0.9 if $shebang =~ /^#!.*\bperl/;</td></tr>
<tr><td class="h">82</td><td colspan="7"></td></tr><tr><td class="h">83</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# We favour Perl as the interpreter for any shebang to preserve</td></tr>
<tr><td class="h">84</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# previous semantics: we used to execute everything via Perl and</td></tr>
<tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# relied on it to pass the shebang off to the appropriate</td></tr>
<tr><td class="h">86</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# interpreter.</td></tr>
<tr><td class="h">87</td><td><div class="c3">163</div></td><td></td><td></td><td></td><td></td><td><div>204</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0.3;</td></tr>
<tr><td class="h">88</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">89</td><td colspan="7"></td></tr><tr><td class="h">90</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L90">100</a></div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0.8 if $file-&gt;{lc_ext} eq &#39;.t&#39;;&nbsp;&nbsp;&nbsp;&nbsp;# vote higher than Executable</td></tr>
<tr><td class="h">91</td><td><div class="c3">3</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L91">100</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0.9 if $file-&gt;{lc_ext} eq &#39;.pl&#39;;</td></tr>
<tr><td class="h">92</td><td colspan="7"></td></tr><tr><td class="h">93</td><td><div class="c3">2</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L93">100</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0.75 if $file-&gt;{dir} =~ /^t\b/;&nbsp;&nbsp;&nbsp;&nbsp;# vote higher than Executable</td></tr>
<tr><td class="h">94</td><td colspan="7"></td></tr><tr><td class="h">95</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# backwards compat, always vote:</td></tr>
<tr><td class="h">96</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0.25;</td></tr>
<tr><td class="h">97</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">98</td><td colspan="7"></td></tr><tr><td class="h">99 - 128</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;make_iterator&gt;

&nbsp;&nbsp;my $iterator = $class-&gt;make_iterator( $source );

Constructs &amp; returns a new L&lt;TAP::Parser::Iterator::Process&gt; for the source.
Assumes C&lt;$source-E&lt;gt&gt;raw&gt; contains a reference to the perl script.&nbsp;&nbsp;C&lt;croak&gt;s
if the file could not be found.

The command to run is built as follows:

&nbsp;&nbsp;$perl @switches $perl_script @test_args

The perl command to use is determined by L&lt;/get_perl&gt;.&nbsp;&nbsp;The command generated
is guaranteed to preserve:

&nbsp;&nbsp;PERL5LIB
&nbsp;&nbsp;PERL5OPT
&nbsp;&nbsp;Taint Mode, if set in the script&#39;s shebang

I&lt;Note:&gt; the command generated will I&lt;not&gt; respect any shebang line defined in
your Perl script.&nbsp;&nbsp;This is only a problem if you have compiled a custom version
of Perl or if you want to use a specific version of Perl for one test and a
different version for another, for example:

&nbsp;&nbsp;#!/path/to/a/custom_perl --some --args
&nbsp;&nbsp;#!/usr/local/perl-5.6/bin/perl -w

Currently you need to write a plugin to get around this.

=cut</pre></td></tr>
<tr><td class="h">129</td><td colspan="7"></td></tr><tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _autoflush_stdhandles {</td></tr>
<tr><td class="h">131</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L131">212</a></div></td><td></td><td><div>204</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($class) = @_;</td></tr>
<tr><td class="h">132</td><td colspan="7"></td></tr><tr><td class="h">133</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>577</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_autoflush( \*STDOUT );</td></tr>
<tr><td class="h">134</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>346</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_autoflush( \*STDERR );</td></tr>
<tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">136</td><td colspan="7"></td></tr><tr><td class="h">137</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub make_iterator {</td></tr>
<tr><td class="h">138</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L138">212</a></div></td><td><div class="c3">1</div></td><td><div>318</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $source ) = @_;</td></tr>
<tr><td class="h">139</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>240</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= $source-&gt;meta;</td></tr>
<tr><td class="h">140</td><td><div class="c3">212</div><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>176</div><div>244</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $perl_script = ${ $source-&gt;raw };</td></tr>
<tr><td class="h">141</td><td colspan="7"></td></tr><tr><td class="h">142</td><td><div class="c3">212</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L142">50</a></div></td><td></td><td></td><td></td><td><div>286</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_croak(&quot;Cannot find ($perl_script)&quot;) unless $meta-&gt;{is_file};</td></tr>
<tr><td class="h">143</td><td colspan="7"></td></tr><tr><td class="h">144</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# TODO: does this really need to be done here?</td></tr>
<tr><td class="h">145</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>402</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_autoflush_stdhandles;</td></tr>
<tr><td class="h">146</td><td colspan="7"></td></tr><tr><td class="h">147</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>572</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $libs, $switches )</td></tr>
<tr><td class="h">148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= $class-&gt;_mangle_switches(</td></tr>
<tr><td class="h">149</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_filter_libs( $class-&gt;_switches($source) ) );</td></tr>
<tr><td class="h">150</td><td colspan="7"></td></tr><tr><td class="h">151</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>443</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_run( $source, $libs, $switches );</td></tr>
<tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">153</td><td colspan="7"></td></tr><tr><td class="h">154</td><td colspan="7"></td></tr><tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _has_taint_switch {</td></tr>
<tr><td class="h">156</td><td><div class="c3">365</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L156">365</a></div></td><td></td><td><div>409</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $class, $switches ) = @_;</td></tr>
<tr><td class="h">157</td><td colspan="7"></td></tr><tr><td class="h">158</td><td><div class="c3">365</div><div class="c3">253</div><div class="c3">365</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L158">100</a></div></td><td></td><td></td><td></td><td><div>292</div><div>539</div><div>368</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $has_taint = grep { $_ eq &quot;-T&quot; || $_ eq &quot;-t&quot; } @{$switches};</td></tr>
<tr><td class="h">159</td><td><div class="c3">365</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L159">100</a></div></td><td></td><td></td><td></td><td><div>795</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $has_taint ? 1 : 0;</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">161</td><td colspan="7"></td></tr><tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _mangle_switches {</td></tr>
<tr><td class="h">163</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L163">212</a></div></td><td></td><td><div>296</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $libs, $switches ) = @_;</td></tr>
<tr><td class="h">164</td><td colspan="7"></td></tr><tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Taint mode ignores environment variables so we must retranslate</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# PERL5LIB as -I switches and place PERL5OPT on the command line</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# in order that it be seen.</td></tr>
<tr><td class="h">168</td><td><div class="c3">212</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L168">100</a></div></td><td></td><td></td><td></td><td><div>367</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $class-&gt;_has_taint_switch($switches) ) {</td></tr>
<tr><td class="h">169</td><td><div class="c3">15</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L169">50</a></div></td><td></td><td></td><td></td><td><div>162</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @perl5lib = defined $ENV{PERL5LIB} ? split /$Config{path_sep}/, $ENV{PERL5LIB} : ();</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$libs,</td></tr>
<tr><td class="h">172</td><td><div class="c3">15</div></td><td></td><td></td><td></td><td></td><td><div>79</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;&nbsp;@{$switches},</td></tr>
<tr><td class="h">173</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$class-&gt;_libs2switches([@$libs, @perl5lib]),</td></tr>
<tr><td class="h">174</td><td><div class="c3">15</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L174">100</a></div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defined $ENV{PERL5OPT} ? shellwords( $ENV{PERL5OPT} ) : ()</td></tr>
<tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],</td></tr>
<tr><td class="h">176</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">177</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">178</td><td colspan="7"></td></tr><tr><td class="h">179</td><td><div class="c3">197</div></td><td></td><td></td><td></td><td></td><td><div>276</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $libs, $switches );</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">181</td><td colspan="7"></td></tr><tr><td class="h">182</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _filter_libs {</td></tr>
<tr><td class="h">183</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L183">212</a></div></td><td></td><td><div>276</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, @switches ) = @_;</td></tr>
<tr><td class="h">184</td><td colspan="7"></td></tr><tr><td class="h">185</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>2102</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $path_sep = $Config{path_sep};</td></tr>
<tr><td class="h">186</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>687</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $path_re&nbsp;&nbsp;= qr{$path_sep};</td></tr>
<tr><td class="h">187</td><td colspan="7"></td></tr><tr><td class="h">188</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Filter out any -I switches to be handled as libs later.</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#</td></tr>
<tr><td class="h">190</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Nasty kludge. It might be nicer if we got the libs separately</td></tr>
<tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# although at least this way we find any -I switches that were</td></tr>
<tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# supplied other then as explicit libs.</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#</td></tr>
<tr><td class="h">194</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# We filter out any names containing colons because they will break</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# PERL5LIB</td></tr>
<tr><td class="h">196</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>198</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @libs;</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @filtered_switches;</td></tr>
<tr><td class="h">198</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>231</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for (@switches) {</td></tr>
<tr><td class="h">199</td><td><div class="c3">496</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L199">100</a></div></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--condition.html#L199">100</a></div></td><td></td><td></td><td><div>2025</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( !/$path_re/ &amp;&amp; m/ ^ [&#39;&quot;]? -I [&#39;&quot;]? (.*?) [&#39;&quot;]? $ /x ) {</td></tr>
<tr><td class="h">200</td><td><div class="c3">412</div></td><td></td><td></td><td></td><td></td><td><div>496</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @libs, $1;</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">202</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">203</td><td><div class="c3">84</div></td><td></td><td></td><td></td><td></td><td><div>115</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @filtered_switches, $_;</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">206</td><td colspan="7"></td></tr><tr><td class="h">207</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>582</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return \@libs, \@filtered_switches;</td></tr>
<tr><td class="h">208</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">209</td><td colspan="7"></td></tr><tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _iterator_hooks {</td></tr>
<tr><td class="h">211</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L211">212</a></div></td><td></td><td><div>306</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $source, $libs, $switches ) = @_;</td></tr>
<tr><td class="h">212</td><td colspan="7"></td></tr><tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $setup = sub {</td></tr>
<tr><td class="h">214</td><td><div class="c3">212</div><div class="c3">212</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L214">100</a></div></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--condition.html#L214">100</a></div></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L214">212</a></div></td><td></td><td><div>180</div><div>455</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( @{$libs} and !$class-&gt;_has_taint_switch($switches) ) {</td></tr>
<tr><td class="h">215</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{PERL5LIB} = join(</td></tr>
<tr><td class="h">216</td><td><div class="c3">513</div><div class="c3">141</div></td><td></td><td></td><td></td><td></td><td><div>955</div><div>143</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Config{path_sep}, grep {defined} @{$libs},</td></tr>
<tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{PERL5LIB}</td></tr>
<tr><td class="h">218</td><td><div class="c3">141</div></td><td></td><td></td><td></td><td></td><td><div>397</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">219</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">220</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>620</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">221</td><td colspan="7"></td></tr><tr><td class="h">222</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# VMS environment variables aren&#39;t guaranteed to reset at the end of</td></tr>
<tr><td class="h">223</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# the process, so we need to put PERL5LIB back.</td></tr>
<tr><td class="h">224</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>341</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $previous = $ENV{PERL5LIB};</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $teardown = sub {</td></tr>
<tr><td class="h">226</td><td><div class="c3">207</div></td><td><div class="c0" title="T/-"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L226">50</a></div></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L226">207</a></div></td><td></td><td><div>274</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( defined $previous ) {</td></tr>
<tr><td class="h">227</td><td><div class="c3">207</div></td><td></td><td></td><td></td><td></td><td><div>1222</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{PERL5LIB} = $previous;</td></tr>
<tr><td class="h">228</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">230</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $ENV{PERL5LIB};</td></tr>
<tr><td class="h">231</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">232</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>349</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">233</td><td colspan="7"></td></tr><tr><td class="h">234</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>431</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $setup, $teardown );</td></tr>
<tr><td class="h">235</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">236</td><td colspan="7"></td></tr><tr><td class="h">237</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _run {</td></tr>
<tr><td class="h">238</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L238">212</a></div></td><td></td><td><div>287</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $source, $libs, $switches ) = @_;</td></tr>
<tr><td class="h">239</td><td colspan="7"></td></tr><tr><td class="h">240</td><td><div class="c3">212</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L240">50</a></div></td><td></td><td></td><td></td><td><div>402</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @command = $class-&gt;_get_command_for_switches( $source, $switches )</td></tr>
<tr><td class="h">241</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or $class-&gt;_croak(&quot;No command found!&quot;);</td></tr>
<tr><td class="h">242</td><td colspan="7"></td></tr><tr><td class="h">243</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>310</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $setup, $teardown ) = $class-&gt;_iterator_hooks( $source, $libs, $switches );</td></tr>
<tr><td class="h">244</td><td colspan="7"></td></tr><tr><td class="h">245</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>330</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $class-&gt;_create_iterator( $source, \@command, $setup, $teardown );</td></tr>
<tr><td class="h">246</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">247</td><td colspan="7"></td></tr><tr><td class="h">248</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _create_iterator {</td></tr>
<tr><td class="h">249</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L249">212</a></div></td><td></td><td><div>302</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $source, $command, $setup, $teardown ) = @_;</td></tr>
<tr><td class="h">250</td><td colspan="7"></td></tr><tr><td class="h">251</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>323</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return TAP::Parser::Iterator::Process-&gt;new(</td></tr>
<tr><td class="h">252</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;command&nbsp;&nbsp;=&gt; $command,</td></tr>
<tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;merge&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $source-&gt;merge,</td></tr>
<tr><td class="h">254</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setup&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $setup,</td></tr>
<tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;teardown =&gt; $teardown,</td></tr>
<tr><td class="h">256</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">257</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">258</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">259</td><td colspan="7"></td></tr><tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_command_for_switches {</td></tr>
<tr><td class="h">261</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L261">212</a></div></td><td></td><td><div>260</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $source, $switches ) = @_;</td></tr>
<tr><td class="h">262</td><td><div class="c3">212</div><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>150</div><div>236</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file&nbsp;&nbsp;&nbsp;&nbsp;= ${ $source-&gt;raw };</td></tr>
<tr><td class="h">263</td><td><div class="c3">212</div><div class="c3">212</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L263">100</a></div></td><td></td><td></td><td></td><td><div>176</div><div>265</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @args&nbsp;&nbsp;&nbsp;&nbsp;= @{ $source-&gt;test_args || [] };</td></tr>
<tr><td class="h">264</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>317</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $command = $class-&gt;get_perl;</td></tr>
<tr><td class="h">265</td><td colspan="7"></td></tr><tr><td class="h">266</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;# XXX don&#39;t need to quote if we treat the parts as atoms (except maybe vms)</td></tr>
<tr><td class="h">267</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;#$file = qq[&quot;$file&quot;] if ( $file =~ /\s/ ) &amp;&amp; ( $file !~ /^&quot;.*&quot;$/ );</td></tr>
<tr><td class="h">268</td><td><div class="c3">212</div><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>196</div><div>260</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @command = ( $command, @{$switches}, $file, @args );</td></tr>
<tr><td class="h">269</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>415</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @command;</td></tr>
<tr><td class="h">270</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">271</td><td colspan="7"></td></tr><tr><td class="h">272</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _libs2switches {</td></tr>
<tr><td class="h">273</td><td><div class="c3">15</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L273">15</a></div></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $class = shift;</td></tr>
<tr><td class="h">274</td><td><div class="c3">15</div><div class="c3">101</div><div class="c3">101</div><div class="c3">15</div></td><td></td><td></td><td></td><td></td><td><div>18</div><div>137</div><div>92</div><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return map {&quot;-I$_&quot;} grep {$_} @{ $_[0] };</td></tr>
<tr><td class="h">275</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">276</td><td colspan="7"></td></tr><tr><td class="h">277 - 287</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;get_taint&gt;

Decode any taint switches from a Perl shebang line.

&nbsp;&nbsp;# $taint will be &#39;t&#39;
&nbsp;&nbsp;my $taint = TAP::Parser::SourceHandler::Perl-&gt;get_taint( &#39;#!/usr/bin/perl -t&#39; );

&nbsp;&nbsp;# $untaint will be undefined
&nbsp;&nbsp;my $untaint = TAP::Parser::SourceHandler::Perl-&gt;get_taint( &#39;#!/usr/bin/perl&#39; );

=cut</pre></td></tr>
<tr><td class="h">288</td><td colspan="7"></td></tr><tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_taint {</td></tr>
<tr><td class="h">290</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L290">212</a></div></td><td><div class="c3">1</div></td><td><div>275</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $shebang ) = @_;</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return</td></tr>
<tr><td class="h">292</td><td><div class="c3">212</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L292">100</a></div></td><td><div class="c0"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--condition.html#L292">67</a></div></td><td></td><td></td><td><div>853</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless defined $shebang</td></tr>
<tr><td class="h">293</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; $shebang =~ /^#!.*\bperl.*\s-\w*([Tt]+)/;</td></tr>
<tr><td class="h">294</td><td><div class="c3">15</div></td><td></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $1;</td></tr>
<tr><td class="h">295</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">296</td><td colspan="7"></td></tr><tr><td class="h">297</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _switches {</td></tr>
<tr><td class="h">298</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L298">212</a></div></td><td></td><td><div>225</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $source ) = @_;</td></tr>
<tr><td class="h">299</td><td><div class="c3">212</div><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>182</div><div>221</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= ${ $source-&gt;raw };</td></tr>
<tr><td class="h">300</td><td><div class="c3">212</div><div class="c3">212</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L300">100</a></div></td><td></td><td></td><td></td><td><div>158</div><div>213</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @switches = @{ $source-&gt;switches || [] };</td></tr>
<tr><td class="h">301</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>210</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $shebang&nbsp;&nbsp;= $source-&gt;meta-&gt;{file}-&gt;{shebang};</td></tr>
<tr><td class="h">302</td><td><div class="c3">212</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L302">50</a></div></td><td></td><td></td><td></td><td><div>215</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless defined $shebang;</td></tr>
<tr><td class="h">303</td><td colspan="7"></td></tr><tr><td class="h">304</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>403</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $taint = $class-&gt;get_taint($shebang);</td></tr>
<tr><td class="h">305</td><td><div class="c3">212</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L305">100</a></div></td><td></td><td></td><td></td><td><div>217</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @switches, &quot;-$taint&quot; if defined $taint;</td></tr>
<tr><td class="h">306</td><td colspan="7"></td></tr><tr><td class="h">307</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Quote the argument if we&#39;re VMS, since VMS will downcase anything</td></tr>
<tr><td class="h">308</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# not quoted.</td></tr>
<tr><td class="h">309</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>154</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (IS_VMS) {</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (@switches) {</td></tr>
<tr><td class="h">311</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_ = qq[&quot;$_&quot;];</td></tr>
<tr><td class="h">312</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">314</td><td colspan="7"></td></tr><tr><td class="h">315</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>525</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @switches;</td></tr>
<tr><td class="h">316</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">317</td><td colspan="7"></td></tr><tr><td class="h">318 - 322</td><td colspan="6"></td><td class="s"><pre>=head3 C&lt;get_perl&gt;

Gets the version of Perl currently running the test suite.

=cut</pre></td></tr>
<tr><td class="h">323</td><td colspan="7"></td></tr><tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_perl {</td></tr>
<tr><td class="h">325</td><td><div class="c3">212</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--subroutine.html#L325">212</a></div></td><td><div class="c3">1</div></td><td><div>159</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $class = shift;</td></tr>
<tr><td class="h">326</td><td><div class="c3">212</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L326">50</a></div></td><td></td><td></td><td></td><td><div>336</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ENV{HARNESS_PERL} if defined $ENV{HARNESS_PERL};</td></tr>
<tr><td class="h">327</td><td><div class="c3">212</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--branch.html#L327">50</a></div></td><td><div class="c0"><a href="blib-lib-TAP-Parser-SourceHandler-Perl-pm--condition.html#L327">33</a></div></td><td></td><td></td><td><div>815</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return qq[&quot;$^X&quot;] if IS_WIN32 &amp;&amp; ( $^X =~ /[^\w\.\/\\]/ );</td></tr>
<tr><td class="h">328</td><td><div class="c3">212</div></td><td></td><td></td><td></td><td></td><td><div>218</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $^X;</td></tr>
<tr><td class="h">329</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">330</td><td colspan="7"></td></tr><tr><td class="h">331</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
<tr><td class="h">332</td><td colspan="7"></td></tr></table>
</body>
</html>
